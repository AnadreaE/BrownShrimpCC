devtools::load_all(".")
#HERE SIMULATIONS WITH NEW K-FUNC tpc FLEXBRIERE
library(ggplot2)
library(deSolve)
library(RColorBrewer)
library(BrownShrimp)
library(viridis)
library(dplyr)
library(tidyr)
#library(devtools)
#UPLOAD TEMPERATURE DATA
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_10_11 <- temperature_func(temperature_dataSet, "01/01/2010", "31/12/2011")
temperature_10_14 <- temperature_func(temperature_dataSet, "01/01/2010", "31/12/2014")
######### START ###########
#Def. Size Classes ranges [cm]
L_as_F <- 8.5
L_as_M = 5.5
juvI_min <- .6
juvI_max <- 1.0
juvII_min  <- 1.0
juvII_max <- 2.0
juvIII_min  <- 2.0
juvIII_max <- 3.0
juvIV_min  <- 3.0
juvIV_max <- 4.0
juvV_min  <- 4.0
juvV_max <- 5.0
adultI_min <- 5.0
adultI_max <- 6.0
adultII_min <- 6.0
adultII_max <- 7.0
adultIII_min <- 7.0
adultIII_max <- 8.5#Linf_F
LL = 0.3
LJ = (juvI_min+juvI_max)/2 #cm
LJ2 = (juvII_min+juvII_max)/2   # 3cm
LJ3 = (juvIII_min+juvIII_max)/2
LJ4 = (juvIV_min+juvIV_max)/2
LJ5 = (juvV_min+juvV_max)/2
LA1 = (adultI_min + adultI_max)/2
LA2 = (adultII_min + adultII_max)/2  #cm
LA3 = (adultIII_min + adultIII_max)/2  #cm
state <- c(P = 2, E = 0.1, L= 0.4 ,
J_f = .175*0.5 , J2_f = 0.125*0.5, J3_f = 0.125*0.5, J4_f = 0.1*0.5, J5_f = 0.1*0.5,
J_m = .175*0.5 , J2_m = 0.125*0.5, J3_m = 0.125*0.5, J4_m = 0.1*0.5, J5_m = 0.1*0.5,
A1_f = 0.25*0.5, A1_m = 0.25*0.5,
A2 = 0.1, A3=0.1) #males doesn't reach this size classes
t = seq(0,length(temperature_10_11$temperature)-0.1, by = 0.1)
t_5years = seq(0,length(temperature_10_14$temperature)-0.1, by = 0.1)
parameters = c()
start <- Sys.time()
test_sex <- solver_sizeClass_sex(t = t_5years, state = state, parameters = parameters, temperature_10_14)
print(Sys.time() - start)
start_date <- as.POSIXct("2010-01-01", format="%Y-%m-%d", tz = "UTC")
test_sex <- mutate(test_sex, dateTime = start_date + test_sex$time * 86400) #86400 seconds in one day
test_sex <- test_sex[ , -1] # delete timesteps column
#cc_long_2 <- gather(cc_2, key = "Type", value = "Value", P, E, L, J, J2, J3, J4, J5, A1, A2)
test_sex_long <- test_sex %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
#dev.off()
ggplot(test_sex_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " TPC-sex F and M \n 2010-2014", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,
"J_f" = "#8856a7", "J2_f" = "#8856a7", "J3_f" = "#8856a7", "J4_f" = "#8856a7", "J5_f" = "#8856a7",
"J_m" = "#9ebcda", "J2_m" = "#9ebcda", "J3_m" = "#9ebcda", "J4_m" = "#9ebcda", "J5_m" = "#9ebcda",
"A1_f" = "#fd8d3c" , "A1_m" = "maroon4" ,
"A2" = "#e6550d" , "A3" = 'red2')) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom")
df_long_testSex <- test_sex[ , -1] %>% #delete  plancton col
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
#ensure that vertical order is same as life stages
stack_order <- rev(c(colnames(test_sex)[2:17]) )
# Ensure 'variable' is a factor with levels in the same order
df_long_testSex$variable <- factor(df_long_testSex$variable, levels = stack_order)
ggplot(df_long_testSex, aes(x = dateTime, y = value, fill = variable)) +
geom_area() +
scale_fill_viridis_d() +
labs(
title = "TPC sex",
x = "Date",
y = "Biomass",
fill = "Size class"
)
######### START ###########
#Def. Size Classes ranges [cm]
Linf_F <- 8.5
Linf_M <- 5.5
juvI_min <- .6
juvI_max <- 1.0
juvII_min  <- 1.0
juvII_max <- 2.0
juvIII_min  <- 2.0
juvIII_max <- 3.0
juvIV_min  <- 3.0
juvIV_max <- 4.0
juvV_min  <- 4.0
juvV_max <- 5.0
adultI_min <- 5.0
adultI_max <- 6.0
adultII_min <- 6.0
adultII_max <- 7.0
adultIII_min <- 7.0
adultIII_max <- Linf_F
#Define mean sizes for each range [cm]
LL = 0.3
LJ = (juvI_min+juvI_max)/2
LJ2 = (juvII_min+juvII_max)/2
LJ3 = (juvIII_min+juvIII_max)/2
LJ4 = (juvIV_min+juvIV_max)/2
LJ5 = (juvV_min+juvV_max)/2
LA1 = (adultI_min + adultI_max)/2
LA2 = (adultII_min + adultII_max)/2
LA3 = (adultIII_min + adultIII_max)/2
sizeClass_names = c("LJ", "LJ2", "LJ3", "LJ4", "LJ5", "LA1", "LA2", "LA3" )
sizeClass_means = c(LJ, LJ2, LJ3, LJ4, LJ5, LA1, LA2, LA3 )
#### Def. growth function (as function of time) ####
time_range <- seq(1,1095)
temperature_range <- seq(0,30, 0.1) #(10,15)
k_vals = sapply(temperature_range, K_func_briere, sex = 'M')
#### JUVI ####
Mdevelopment.df_juvI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C & store results columns wise in the df:
for (i in temperature_range){
development <- c()
initial_l <- 0.6 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "M")
#initial_l = growth #+  L_init
development = append(development, growth)
}
Mdevelopment.df_juvI[as.character(i)] <- development
}
Mdevelopment.df_juvI = Mdevelopment.df_juvI[ , !(names(Mdevelopment.df_juvI) == "row")] #delete first column with timesteps, same as index
#Count how many time steps there are, where individual's size is between min and max size of its size class range:
dev_time_MjuvI <- sapply(Mdevelopment.df_juvI, function(col){
BrownShrimp::count_devDays(col, juvI_min, juvI_max) } )
#With following plot, we know the shape of the curve (U shape. But inverted is again TPC)
plot( (1:length(dev_time_MjuvI))*0.1, dev_time_MjuvI, main = "Development days Male Juvenile I \n min_size = 0.6 cm and max_size = 1 cm" )
k_vals_M = sapply(temperature_range, K_func_briere, sex = 'M')
plot( (1:length(dev_time_MjuvI))*0.1, 1/dev_time_MjuvI, main = "1/Development days Juvenile I \n min_size = 0.6 cm and max_size = 1 cm" )
lines(temperature_range, k_vals_M, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
indexes_1095 <- which(dev_time_MjuvI == 1095 | dev_time_MjuvI == 0)
dev_time_MJUVI_reduced <- dev_time_juvI[dev_time_MjuvI != 1095 & dev_time_MjuvI != 0]
dev_time_MJUVI_reduced <- dev_time_MjuvI[dev_time_MjuvI != 1095 & dev_time_MjuvI != 0]
temperature_range_red_MjuvI <- temperature_range[-indexes_1095]
k_vals_reduced_MJUVI = k_vals_M[-indexes_1095]
devTime_MjuvI_inv_reduced = 1/dev_time_MJUVI_reduced
k_vals_reduced_MJUVI_inv = 1/k_vals_reduced_MJUVI
fit_M.JuvI = lm(dev_time_MJUVI_reduced ~ k_vals_reduced_MJUVI_inv )
summary(fit_M.JuvI)
plot( (1:length(dev_time_MjuvI))*0.1, dev_time_MjuvI, main = "Development days Juvenile M vs fit I \n min_size = 0.6 cm and max_size = 1 cm" )
lines(temperature_range_red_MjuvI, predict(fit_M.JuvI), col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
development.df_MjuvII <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C & store results columns wise in the df:
for (i in temperature_range){
development <- c()
initial_l <- 1 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "M")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MjuvII[as.character(i)] <- development
}
development.df_MjuvII = development.df_MjuvII[ , !(names(development.df_MjuvII) == "row")] #delete first column with timesteps, same as index
#Count how many time steps there are, where individual's size is between min and max size of its size class range:
dev_time_MjuvII <- sapply(development.df_MjuvII, function(col){
BrownShrimp::count_devDays(col, juvII_min, juvII_max) } )
#With following plot, we know the shape of the curve (U shape. But inverted is again TPC)
plot( (1:length(dev_time_MjuvII))*0.1, dev_time_MjuvII, main = "Development days Juvenile I \n min_size = 0.6 cm and max_size = 1 cm" )
plot( (1:length(dev_time_MjuvII))*0.1, 1/dev_time_MjuvII, main = "1/Development days Juvenile II \n min_size = 1 cm and max_size = 2 cm" )
lines(temperature_range, k_vals, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
plot( (1:length(dev_time_MjuvII))*0.1, 1/dev_time_MjuvII, main = "1/Development days Juvenile II \n min_size = 1 cm and max_size = 2 cm" )
lines(temperature_range, k_vals_M, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
indexes_1095 <- which(dev_time_MjuvII == 1095)
dev_time_MjuvII_reduced <- dev_time_MjuvII[dev_time_MjuvII != 1095]
temperature_range_red_MjuvII <- temperature_range[-indexes_1095]
k_vals_reduced_MjuvII = k_vals_M[-indexes_1095]
indexes_1095 <- which(dev_time_MjuvII == 1095)
dev_time_MjuvII_reduced <- dev_time_MjuvII[dev_time_MjuvII != 1095]
temperature_range_red_MjuvII <- temperature_range[-indexes_1095]
k_vals_reduced_MjuvII = k_vals_M[-indexes_1095]
devTime_MjuvII_inv_reduced = 1/dev_time_MjuvII_reduced
k_vals_reduced_MjuvII_inv = 1/k_vals_reduced_MjuvII
fit_MjuvII = lm(dev_time_MjuvII_reduced ~ k_vals_reduced_MjuvII_inv )
summary(fit_MjuvII)
plot( (1:length(dev_time_MjuvII))*0.1, dev_time_MjuvII, main = "Development days Juvenile II vs fit \n min_size = 1 cm and max_size = 2 cm" )
lines(temperature_range_red_MjuvII, predict(fit_MjuvII), col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("black", "#1c9099"))
for (i in temperature_range){
development <- c()
initial_l <- 2 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "F")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MjuvIII[as.character(i)] <- development
}
development.df_MjuvIII <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C & store results columns wise in the df:
for (i in temperature_range){
development <- c()
initial_l <- 2 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "F")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MjuvIII[as.character(i)] <- development
}
development.df_MjuvIII = development.df_MjuvIII[ , !(names(development.df_MjuvIII) == "row")] #delete first column with timesteps, same as index
#Count how many time steps there are, where individual's size is between min and max size of its size class range:
dev_time_MjuvIII <- sapply(development.df_MjuvIII, function(col){
BrownShrimp::count_devDays(col, juvIII_min, juvIII_max) } )
#With following plot, we know the shape of the curve (U shape. But inverted is again TPC)
#plot( (1:length(dev_time_MjuvIII))*0.1, dev_time_MjuvIII, main = "Development days Juvenile III \n min_size = 0.6 cm and max_size = 1 cm" )
plot( (1:length(dev_time_MjuvIII))*0.1, 1/dev_time_MjuvIII, main = "1/Development days Juvenile III \n min_size = 2 cm and max_size = 3 cm" )
lines(temperature_range, k_vals_M, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
development.df_MjuvIII <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C & store results columns wise in the df:
for (i in temperature_range){
development <- c()
initial_l <- 2 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "M")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MjuvIII[as.character(i)] <- development
}
development.df_MjuvIII = development.df_MjuvIII[ , !(names(development.df_MjuvIII) == "row")] #delete first column with timesteps, same as index
#Count how many time steps there are, where individual's size is between min and max size of its size class range:
dev_time_MjuvIII <- sapply(development.df_MjuvIII, function(col){
BrownShrimp::count_devDays(col, juvIII_min, juvIII_max) } )
plot( (1:length(dev_time_MjuvIII))*0.1, 1/dev_time_MjuvIII, main = "1/Development days Juvenile III \n min_size = 2 cm and max_size = 3 cm" )
lines(temperature_range, k_vals_M, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
indexes_1095 <- which(dev_time_MjuvIII == 1095)
dev_time_MjuvIII_reduced <- dev_time_MjuvIII[dev_time_MjuvIII != 1095]
temperature_range_red_MjuvIII <- temperature_range[-indexes_1095]
k_vals_reduced_MjuvIII = k_vals_M[-indexes_1095]
devTime_MjuvIII_inv_reduced = 1/dev_time_MjuvIII_reduced
k_vals_reduced_MjuvIII_inv = 1/k_vals_reduced_MjuvIII
fit_MjuvIII = lm(dev_time_MjuvIII_reduced ~ k_vals_reduced_MjuvIII_inv )
summary(fit_MjuvIII)
plot( (1:length(dev_time_MjuvIII))*0.1, dev_time_MjuvIII, main = "Development days Juvenile III vs fit \n min_size = 2 cm and max_size = 3 cm" )
lines(temperature_range_red_MjuvIII, predict(fit_MjuvIII), col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("black", "#1c9099"))
development.df_MjuvIV <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C & store results columns wise in the df:
for (i in temperature_range){
development <- c()
initial_l <- 3 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "M")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MjuvIV[as.character(i)] <- development
}
development.df_MjuvIV = development.df_MjuvIV[ , !(names(development.df_MjuvIV) == "row")] #delete first column with timesteps, same as index
#Count how many time steps there are, where individual's size is between min and max size of its size class range:
dev_time_MjuvIV <- sapply(development.df_MjuvIV, function(col){
BrownShrimp::count_devDays(col, juvIV_min, juvIV_max) } )
plot( (1:length(dev_time_MjuvIV))*0.1, 1/dev_time_MjuvIV, main = "1/Development days Juvenile IV \n min_size = 3 cm and max_size = 4 cm" )
lines(temperature_range, K_vals_M, col = '#1c9099', lwd = 2)
plot( (1:length(dev_time_MjuvIV))*0.1, 1/dev_time_MjuvIV, main = "1/Development days Juvenile IV \n min_size = 3 cm and max_size = 4 cm" )
lines(temperature_range, k_vals_M, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
plot( (1:length(dev_time_MjuvIV))*0.1, 1/dev_time_MjuvIV, main = "1/Development days Juvenile IV \n min_size = 3 cm and max_size = 4 cm" )
lines(temperature_range, k_vals_M, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
#Deleet values where there is no development i.e. when devTime = 1095
indexes_1095 <- which(dev_time_MjuvIV == 1095)
dev_time_MjuvIV_reduced <- dev_time_MjuvIV[dev_time_MjuvIV != 1095]
temperature_range_red_MjuvIV <- temperature_range[-indexes_1095]
k_vals_reduced_MjuvIV = k_vals_M[-indexes_1095]
devTime_MjuvIV_inv_reduced = 1/dev_time_MjuvIV_reduced
k_vals_reduced_MjuvIV_inv = 1/k_vals_reduced_MjuvIV
fit_MjuvIV = lm(dev_time_MjuvIV_reduced ~ k_vals_reduced_MjuvIV_inv )
summary(fit_MjuvIV)
plot( (1:length(dev_time_MjuvIV))*0.1, dev_time_MjuvIV, main = "Development days Juvenile IV vs fit \n min_size = 3 cm and max_size = 4 cm" )
lines(temperature_range_red_MjuvIV, predict(fit_MjuvIV), col = '#1c90994', lwd = 2)
plot( (1:length(dev_time_MjuvIV))*0.1, dev_time_MjuvIV, main = "Development days Juvenile IV vs fit \n min_size = 3 cm and max_size = 4 cm" )
lines(temperature_range_red_MjuvIV, predict(fit_MjuvIV), col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("black", "#1c9099"))
development.df_MjuvV <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C & store results columns wise in the df:
for (i in temperature_range){
development <- c()
initial_l <- 4 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "M")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MjuvV[as.character(i)] <- development
}
development.df_MjuvV = development.df_MjuvV[ , !(names(development.df_MjuvV) == "row")] #delete first column with timesteps, same as index
#Count how many time steps there are, where individual's size is between min and max size of its size class range:
dev_time_MjuvV <- sapply(development.df_MjuvV, function(col){
BrownShrimp::count_devDays(col, juvV_min, juvV_max) } )
#With following plot, we know the shape of the curve (U shape. But inverted is again TPC)
#plot( (1:length(dev_time_MjuvV))*0.1, dev_time_MjuvV, main = "Development days Juvenile V \n min_size = 4 cm and max_size = 5 cm" )
plot( (1:length(dev_time_MjuvV))*0.1, 1/dev_time_MjuvV, main = "1/Development days Juvenile V \n min_size = 4 cm and max_size = 5 cm" )
lines(temperature_range, k_vals_M, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("grey48", "#1c9099"))
indexes_1095 <- which(dev_time_MjuvV == 1095)
dev_time_MjuvV_reduced <- dev_time_MjuvV[dev_time_MjuvV != 1095]
temperature_range_red_MjuvV <- temperature_range[-indexes_1095]
k_vals_reduced_MjuvV = k_vals_M[-indexes_1095]
devTime_MjuvV_inv_reduced = 1/dev_time_MjuvV_reduced
k_vals_reduced_MjuvV_inv = 1/k_vals_reduced_MjuvV
fit_MjuvV = lm(dev_time_MjuvV_reduced ~ k_vals_reduced_MjuvV_inv )
summary(fit_MjuvV)
plot( (1:length(dev_time_MjuvV))*0.1, dev_time_MjuvV, main = "Development days Juvenile V vs fit \n min_size = 4 cm and max_size = 5 cm" )
lines(temperature_range_red_MjuvV, predict(fit_MjuvV), col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("black", "#1c9099"))
for (i in temperature_range){
development <- c()
initial_l <- 5 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "M")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MaduI[as.character(i)] <- development
}
development.df_MaduI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C & store results columns wise in the df:
for (i in temperature_range){
development <- c()
initial_l <- 5 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "M")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MaduI[as.character(i)] <- development
}
development.df_MaduI = development.df_MaduI[ , !(names(development.df_MaduI) == "row")] #delete first column with timesteps, same as index
#Count how many time steps there are, where individual's size is between min and max size of its size class range:
dev_time_MaduI <- sapply(development.df_MaduI, function(col){
BrownShrimp::count_devDays(col, adultI_min, adultI_max) } )
plot( (1:length(dev_time_MaduI))*0.1, 1/dev_time_MaduI, main = "1/Development days Adult I \n min_size = 5 cm and max_size = 6 cm" )
lines(temperature_range, k_vals_M, col = '#1c9099', lwd = 2)
legend("topright", legend = c('1/devTime', 'K_func_briere'), fill = c("gray48", "#1c9099"))
#Deleet values where there is no development i.e. when devTime = 1095
indexes_1095 <- which(dev_time_MaduI == 1095)
dev_time_MaduI_reduced <- dev_time_MaduI[dev_time_MaduI != 1095]
temperature_range_red_MaduI <- temperature_range[-indexes_1095]
k_vals_reduced_MaduI = k_vals_M[-indexes_1095]
devTime_MaduI_inv_reduced = 1/dev_time_MaduI_reduced
k_vals_reduced_MaduI_inv = 1/k_vals_reduced_MaduI
fit_MaduI = lm(dev_time_MaduI_reduced ~ k_vals_reduced_MaduI_inv )
#With following plot, we know the shape of the curve (U shape. But inverted is again TPC)
plot( (1:length(dev_time_MaduI))*0.1, dev_time_MaduI, main = "Development days Adult I \n min_size = 5 cm and max_size = 6 cm" )
dev_time_MaduI <- sapply(development.df_MaduI, function(col){
BrownShrimp::count_devDays(col, adultI_min, Linf_M) } )
#With following plot, we know the shape of the curve (U shape. But inverted is again TPC)
plot( (1:length(dev_time_MaduI))*0.1, dev_time_MaduI, main = "Development days Adult I \n min_size = 5 cm and max_size = 6 cm" )
development.df_MaduI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C & store results columns wise in the df:
for (i in temperature_range){
development <- c()
initial_l <- 5 #cm
for (j in time_range){
growth = som_growth_thesis(initial_l, j ,i , "M")
#initial_l = growth #+  L_init
development = append(development, growth)
}
development.df_MaduI[as.character(i)] <- development
}
development.df_MaduI = development.df_MaduI[ , !(names(development.df_MaduI) == "row")]
View(development.df_MaduI)
intercepts_M = c(coef(fit_M.JuvI)[1], coef(fit_MjuvII)[1], coef(fit_MjuvIII)[1], coef(fit_MjuvIV)[1], coef(fit_MjuvV)[1] )
factors_M = c(coef(fit_M.JuvI)[2], coef(fit_MjuvII)[2], coef(fit_MjuvIII)[2], coef(fit_MjuvIV)[2], coef(fit_MjuvV)[2])
fits_df = data.frame( row.names = sizeClass_names[1:5], intercept = intercepts_M, factor = factors_M)
View(fits_df)
plot(1:5, fits_df$intercept)
plot(1:5, fits_df$factor)
plot(1:5, fits_df$factor, log = 'xy')
fit_intercepts_M = lm(fitsM_df$intercept ~ sizeClass_means_reduced_M)
fitsM_df = data.frame( row.names = sizeClass_names[1:5], intercept = intercepts_M, factor = factors_M)
#check weather INTERCEPTS show any relation with the mean size of the class:
fit_intercepts_M = lm(fitsM_df$intercept ~ sizeClass_means_reduced_M)
sizeClass_means_reduced_M = sizeClass_means[1:5]
fitsM_df = data.frame( row.names = sizeClass_names[1:5], intercept = intercepts_M, factor = factors_M)
#check weather INTERCEPTS show any relation with the mean size of the class:
fit_intercepts_M = lm(fitsM_df$intercept ~ sizeClass_means_reduced_M)
summary(fit_intercepts_M)
plot(1:5, fitsM_df$intercept)
abline(h= mean(fifitsM_df$intercept), lty=2 )
abline(h= mean(fitsM_df$intercept), lty=2 )
lines(1:(length(sizeClass_names)-1), predict(fit_intercepts_M), col = 'orange3')
lines(1:5, predict(fit_intercepts_M), col = 'orange3')
logx_m = log(sizeClass_means_reduced_M)
logy_m = log(fitsM_df$factor)
fit_factortsLog_m = lm(logy_m ~ logx_m)
summary(fit_factortsLog_m)
log_a_m <- coef(fit_factortsLog)[1]
log_a_m <- coef(fit_factortsLog_m)[1]
b_est_m <- coef(fit_factortsLog_m)[2]
a_est_m <- exp(log_a_m)
plot(sizeClass_means_reduced_M, fitsM_df$factor, log = 'xy')
lines(sizeClass_means_reduced_M, a_est_m * sizeClass_means_reduced_M^b_est_m, col = '#1c9099')
mean(fitsM_df$intercept)
a_est_m
b_est_m
devtools::load_all(".")
#HERE SIMULATIONS WITH NEW K-FUNC tpc FLEXBRIERE
library(ggplot2)
library(deSolve)
library(RColorBrewer)
library(BrownShrimp)
library(viridis)
library(dplyr)
library(tidyr)
#library(devtools)
#UPLOAD TEMPERATURE DATA
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_10_11 <- temperature_func(temperature_dataSet, "01/01/2010", "31/12/2011")
temperature_10_14 <- temperature_func(temperature_dataSet, "01/01/2010", "31/12/2014")
######### START ###########
#Def. Size Classes ranges [cm]
L_as_F <- 8.5
L_as_M = 5.5
juvI_min <- .6
juvI_max <- 1.0
juvII_min  <- 1.0
juvII_max <- 2.0
juvIII_min  <- 2.0
juvIII_max <- 3.0
juvIV_min  <- 3.0
juvIV_max <- 4.0
juvV_min  <- 4.0
juvV_max <- 5.0
adultI_min <- 5.0
adultI_max <- 6.0
adultII_min <- 6.0
adultII_max <- 7.0
adultIII_min <- 7.0
adultIII_max <- 8.5#Linf_F
LL = 0.3
LJ = (juvI_min+juvI_max)/2 #cm
LJ2 = (juvII_min+juvII_max)/2   # 3cm
LJ3 = (juvIII_min+juvIII_max)/2
LJ4 = (juvIV_min+juvIV_max)/2
LJ5 = (juvV_min+juvV_max)/2
LA1 = (adultI_min + adultI_max)/2
LA2 = (adultII_min + adultII_max)/2  #cm
LA3 = (adultIII_min + adultIII_max)/2  #cm
state <- c(P = 2, E = 0.1, L= 0.4 ,
J_f = .175*0.5 , J2_f = 0.125*0.5, J3_f = 0.125*0.5, J4_f = 0.1*0.5, J5_f = 0.1*0.5,
J_m = .175*0.5 , J2_m = 0.125*0.5, J3_m = 0.125*0.5, J4_m = 0.1*0.5, J5_m = 0.1*0.5,
A1_f = 0.25*0.5, A1_m = 0.25*0.5,
A2 = 0.1, A3=0.1) #males doesn't reach this size classes
t = seq(0,length(temperature_10_11$temperature)-0.1, by = 0.1)
t_5years = seq(0,length(temperature_10_14$temperature)-0.1, by = 0.1)
parameters = c()
start <- Sys.time()
test_sex <- solver_sizeClass_sex(t = t_5years, state = state, parameters = parameters, temperature_10_14)
print(Sys.time() - start)
start_date <- as.POSIXct("2010-01-01", format="%Y-%m-%d", tz = "UTC")
test_sex <- mutate(test_sex, dateTime = start_date + test_sex$time * 86400) #86400 seconds in one day
test_sex <- test_sex[ , -1] # delete timesteps column
#cc_long_2 <- gather(cc_2, key = "Type", value = "Value", P, E, L, J, J2, J3, J4, J5, A1, A2)
test_sex_long <- test_sex %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
#dev.off()
ggplot(test_sex_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " TPC-sex F and M \n 2010-2014", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,
"J_f" = "#8856a7", "J2_f" = "#8856a7", "J3_f" = "#8856a7", "J4_f" = "#8856a7", "J5_f" = "#8856a7",
"J_m" = "#9ebcda", "J2_m" = "#9ebcda", "J3_m" = "#9ebcda", "J4_m" = "#9ebcda", "J5_m" = "#9ebcda",
"A1_f" = "#fd8d3c" , "A1_m" = "maroon4" ,
"A2" = "#e6550d" , "A3" = 'red2')) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom") #+ ylim(0, 100)
df_long_testSex <- test_sex[ , -1] %>% #delete  plancton col
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
#ensure that vertical order is same as life stages
stack_order <- rev(c(colnames(test_sex)[2:17]) )
# Ensure 'variable' is a factor with levels in the same order
df_long_testSex$variable <- factor(df_long_testSex$variable, levels = stack_order)
ggplot(df_long_testSex, aes(x = dateTime, y = value, fill = variable)) +
geom_area() +
scale_fill_viridis_d() +
labs(
title = "TPC sex",
x = "Date",
y = "Biomass",
fill = "Size class"
)
