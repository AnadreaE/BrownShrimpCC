plot(test_bothFP$time, test_bothFP$P, type = 'l', xlim = c(0,365))
devtools::load_all(".")
library(ggplot2)
library(deSolve)
library(RColorBrewer)
library(BrownShrimp)
library(viridis)
library(dplyr)
library(tidyr)
library("colorspace")
library(lubridate)
library(latex2exp)
library(profvis)
#library(devtools)
#UPLOAD TEMPERATURE DATA
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_14_18 <- temperature_func(temperature_dataSet, "01/01/2014", "31/12/2018")
ble_data = read.csv("./data/BLE_Inlandslandungen_SpeiseKrabbe.csv", sep = ';')
t_5years = seq(0,length(temperature_14_18$temperature)-0.1)
BF_p = c(1.1476,  2.739,  5.604, 11.65, 21.524, 17.976, 11.613,  5.346) #see calculation in file 'sizeSpectraMoldel.R'
BM_p = c(1.464, 3.645, 8.855, 22.622, 37.614) #see calculation in file 'sizeSpectraMoldel.R'
IC_parameterized = c(P = 2, E = 0.759, L= 0.38  ,
BF = BF_p, BM = BM_p) #Initial conditions according to estimations with fishery landings data.
#### TEST V5 (1 out of 4) WITHOUT ANY KIND OF PREASURE (P NEITHER F) ####
noPreasure_params = parameters_solv
noPreasure_params$general_params$Fi = 0 #No fishery
noPreasure_params$general_params$Imax_ik = 0 #No predation
start <- Sys.time()
test_noPreasure <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
#Plot size spectra
plot_sizeSpectra(test_noPreasure, 2015, title = "NP")
#### TEST V5 (2 out of 4) ONLY PREDATION ####
pred_params = parameters_solv
pred_params$general_params$Fi = 0 #No fishery
start <- Sys.time()
test_predation <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = pred_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
#Plot size spectra
plot_sizeSpectra(test_predation, 2015, title = "Pred")
#### TEST V5 (3 out of 4) ONLY FISHERY ####
fishery_params = parameters_solv
fishery_params$general_params$Imax_ik = 0 #No predation
fishery_params$general_params$Fi = 0.025 #reduced fishery
start <- Sys.time()
test_fishery <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = fishery_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
#Plot size spectra
plot_sizeSpectra(test_fishery, 2015, title = "Fi")
#### TEST V5 (4 out of 4) PREDATION AND FISHERY####
bothPF_params = parameters_solv
bothPF_params$general_params$Fi = 0.025 #reduced fishery
start <- Sys.time()
test_bothFP <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = bothPF_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
#Plot size spectra
plot_sizeSpectra(test_bothFP, 2015, title = "F&P")
year_toSee = 2015
#subset data and sum up to monthly values:
sol_yearToSee = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
par(mfrow = c(1,1))
plot(sol_yearToSee$month, sol_yearToSee$catch.BF1,  type = 'b', main = 'Fished Kg per Km2')
monthly_landing_2015 = sol_yearToSee$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_yearToSee$month, monthly_landing_2015,  type = 'b',
main = 'Monthly landings Germany 2015', ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == 2015], ble_data$t[ble_data$year == 2015], col = 'gray42', lty = 2, lwd = 2)
test_both.V5_red <- test_bothFP[ , c(3:17, 19)] # delete timesteps column, plancton  and predator column
#cc_long_2 <- gather(cc_2, key = "Type", value = "Value", P, E, L, J, J2, J3, J4, J5, A1, A2)
test_both_long <- test_both.V5_red %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
ggplot(test_both_long, aes(x = dateTime, y = value, fill = variable)) +
geom_area() +
scale_fill_viridis_d() +
labs(
title = "System incl. predation ",
x = "Date",
y = "Biomass",
fill = "Size class"
)
plot(test_bothFP$time, test_bothFP$P, type = 'l', xlim = c(0,365))
devtools::load_all(".")
bothPF_params = parameters_solv
bothPF_params$general_params$Fi = 0.025 #reduced fishery
start <- Sys.time()
test_bothFP <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = bothPF_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
plot(test_bothFP$time, test_bothFP$P, type = 'l', xlim = c(0,365))
#define one year to be inspected
year_toSee = 2015
#subset data and sum up to monthly values:
sol_yearToSee = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
par(mfrow = c(1,1))
plot(sol_yearToSee$month, sol_yearToSee$catch.BF1,  type = 'b', main = 'Fished Kg per Km2')
#lines(1:length(monthly_Feffort), monthly_Feffort, col = 'red')
#calculate ttl landings in Germany
monthly_landing_2015 = sol_yearToSee$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_yearToSee$month, monthly_landing_2015,  type = 'b',
main = 'Monthly landings Germany 2015', ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == 2015], ble_data$t[ble_data$year == 2015], col = 'gray42', lty = 2, lwd = 2)
devtools::load_all(".")
library(deSolve)
library(RColorBrewer)
library(BrownShrimp)
library(viridis)
library(dplyr)
library(tidyr)
library("colorspace")
#library(lubridate)
library(latex2exp)
#library(profvis)
#read Ble data
ble_data = read.csv("./data/BLE_Inlandslandungen_SpeiseKrabbe.csv", sep = ';')
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_14_18 <- temperature_func(temperature_dataSet, "01/01/2014", "31/12/2018")
t_5years = seq(0,length(temperature_14_18$temperature)-0.1)
BF_p = c(1.1476,  2.739,  5.604, 11.65, 21.524, 17.976, 11.613,  5.346) #see calculation in file 'sizeSpectraMoldel.R'
BM_p = c(1.464, 3.645, 8.855, 22.622, 37.614) #see calculation in file 'sizeSpectraMoldel.R'
IC_parameterized = c(P = 2, E = 0.759, L= 0.38  ,
BF = BF_p, BM = BM_p) #Initial conditions according to estimations with fishery landings data.
bothPF_params = parameters_solv
bothPF_params$general_params$Fi = 0.025 #reduced fishery
start <- Sys.time()
test_bothFP <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = bothPF_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
par(mfrow = c(1,3))
#Plot fishery catch (for only one year):
#define one year to be inspected
year_toSee = 2015
#subset data and sum up to monthly values:
sol_yearToSee = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_yearToSee$month, sol_yearToSee$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2015 = sol_yearToSee$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_yearToSee$month, monthly_landing_2015,  type = 'b',
main = 'Monthly landings Germany 2015', ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == 2015], ble_data$t[ble_data$year == 2015], col = 'gray42',  lwd = 2)
#Look now on 2016:
year_toSee = 2016
#subset data and sum up to monthly values:
sol_2016 = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_2016$month, sol_2016$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2016 = sol_2016$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_2016$month, monthly_landing_2016,  type = 'b',
main = paste('Monthly landings Germany', year_toSee ), ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == year_toSee], ble_data$t[ble_data$year == year_toSee], col = 'gray42', lty = 2, lwd = 2)
#Look now on 2017:
year_toSee = 2017
#subset data and sum up to monthly values:
sol_2017 = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_2016$month, sol_2016$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2017 = sol_2017$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_2017$month, monthly_landing_2017,  type = 'b',
main = paste('Monthly landings Germany', year_toSee ), ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == year_toSee], ble_data$t[ble_data$year == year_toSee], col = 'gray42', lwd = 2, type = 'o') #, lty = 2
devtools::load_all(".")
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_14_18 <- temperature_func(temperature_dataSet, "01/01/2014", "31/12/2018")
t_5years = seq(0,length(temperature_14_18$temperature)-0.1)
BF_p = c(1.1476,  2.739,  5.604, 11.65, 21.524, 17.976, 11.613,  5.346) #see calculation in file 'sizeSpectraMoldel.R'
BM_p = c(1.464, 3.645, 8.855, 22.622, 37.614) #see calculation in file 'sizeSpectraMoldel.R'
IC_parameterized = c(P = 2, E = 0.759, L= 0.38  ,
BF = BF_p, BM = BM_p) #Initial conditions according to estimations with fishery landings data.
bothPF_params = parameters_solv
bothPF_params$general_params$Fi = 0.025 #reduced fishery
start <- Sys.time()
test_bothFP <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = bothPF_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
#Plot size spectra
plot_sizeSpectra(test_bothFP, 2015, title = "F&P")
par(mfrow = c(1,3))
#Plot fishery catch (for only one year):
#define one year to be inspected
year_toSee = 2015
#subset data and sum up to monthly values:
sol_yearToSee = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_yearToSee$month, sol_yearToSee$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2015 = sol_yearToSee$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_yearToSee$month, monthly_landing_2015,  type = 'b',
main = 'Monthly landings Germany 2015', ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == 2015], ble_data$t[ble_data$year == 2015], col = 'gray42',  lwd = 2)
#Look now on 2016:
year_toSee = 2016
#subset data and sum up to monthly values:
sol_2016 = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_2016$month, sol_2016$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2016 = sol_2016$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_2016$month, monthly_landing_2016,  type = 'b',
main = paste('Monthly landings Germany', year_toSee ), ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == year_toSee], ble_data$t[ble_data$year == year_toSee], col = 'gray42', lty = 2, lwd = 2)
#Look now on 2017:
year_toSee = 2017
#subset data and sum up to monthly values:
sol_2017 = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_2016$month, sol_2016$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2017 = sol_2017$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_2017$month, monthly_landing_2017,  type = 'b',
main = paste('Monthly landings Germany', year_toSee ), ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == year_toSee], ble_data$t[ble_data$year == year_toSee], col = 'gray42', lwd = 2, type = 'o') #, lty = 2
plot(test_bothFP$time, test_bothFP$P, type = 'l', xlim = c(0,365))
par(mfrow = c(1,1))
plot(test_bothFP$time, test_bothFP$P, type = 'l', xlim = c(0,365))
devtools::load_all(".")
bothPF_params = parameters_solv
bothPF_params$general_params$Fi = 0.025 #reduced fishery
start <- Sys.time()
test_bothFP <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = bothPF_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
par(mfrow = c(1,3))
#Plot fishery catch (for only one year):
#define one year to be inspected
year_toSee = 2015
#subset data and sum up to monthly values:
sol_yearToSee = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_yearToSee$month, sol_yearToSee$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2015 = sol_yearToSee$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_yearToSee$month, monthly_landing_2015,  type = 'b',
main = 'Monthly landings Germany 2015', ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == 2015], ble_data$t[ble_data$year == 2015], col = 'gray42',  lwd = 2)
#Look now on 2016:
year_toSee = 2016
#subset data and sum up to monthly values:
sol_2016 = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_2016$month, sol_2016$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2016 = sol_2016$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_2016$month, monthly_landing_2016,  type = 'b',
main = paste('Monthly landings Germany', year_toSee ), ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == year_toSee], ble_data$t[ble_data$year == year_toSee], col = 'gray42', lty = 2, lwd = 2)
#Look now on 2017:
year_toSee = 2017
#subset data and sum up to monthly values:
sol_2017 = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_2016$month, sol_2016$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2017 = sol_2017$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_2017$month, monthly_landing_2017,  type = 'b',
main = paste('Monthly landings Germany', year_toSee ), ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == year_toSee], ble_data$t[ble_data$year == year_toSee], col = 'gray42', lwd = 2, type = 'o') #, lty = 2
plot(test_bothFP$time, test_bothFP$P, type = 'l', xlim = c(0,365))
bothPF_params$general_params$Fi = 0.05 #reduced fishery
start <- Sys.time()
test_bothFP <- solver_sizeClass.v5(t = t_5years, state = IC_parameterized, parameters = bothPF_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
#Plot size spectra
plot_sizeSpectra(test_bothFP, 2015, title = "F&P")
par(mfrow = c(1,3))
#Plot fishery catch (for only one year):
#define one year to be inspected
year_toSee = 2015
#subset data and sum up to monthly values:
sol_yearToSee = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_yearToSee$month, sol_yearToSee$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2015 = sol_yearToSee$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_yearToSee$month, monthly_landing_2015,  type = 'b',
main = 'Monthly landings Germany 2015', ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == 2015], ble_data$t[ble_data$year == 2015], col = 'gray42',  lwd = 2)
#Look now on 2016:
year_toSee = 2016
#subset data and sum up to monthly values:
sol_2016 = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_2016$month, sol_2016$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2016 = sol_2016$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_2016$month, monthly_landing_2016,  type = 'b',
main = paste('Monthly landings Germany', year_toSee ), ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == year_toSee], ble_data$t[ble_data$year == year_toSee], col = 'gray42', lty = 2, lwd = 2)
#Look now on 2017:
year_toSee = 2017
#subset data and sum up to monthly values:
sol_2017 = test_bothFP %>%
filter(as.numeric(format(test_bothFP$dateTime,'%Y')) == year_toSee) %>%
mutate(month = month(dateTime)) %>%
group_by(month) %>%
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE)))
#par(mfrow = c(1,1))
#plot(sol_2016$month, sol_2016$catch.BF1,  type = 'b', main = 'Fished Kg per Km2 per month')
#Calculate the total landings per month (considering 50% discard):
monthly_landing_2017 = sol_2017$catch.BF1 * 14701.5 / 1000 #ttl area = 14701,5 ; convert Kg to t /1000
plot(sol_2017$month, monthly_landing_2017,  type = 'b',
main = paste('Monthly landings Germany', year_toSee ), ylim = c(0,1800), col = '#c994c7', lwd = 2)
lines(ble_data$month[ble_data$year == year_toSee], ble_data$t[ble_data$year == year_toSee], col = 'gray42', lwd = 2, type = 'o') #, lty = 2
#'------------------------------------------------------------------------------
#
# Script to extract and process VMS and logbook data for ICES VMS data call
# 3: Construct and collect tables                                         ----
#
#'------------------------------------------------------------------------------
# Loop through years to submit
for(year in yearsToSubmit){
# load data
load(file = paste0(outPath,paste0("/processedEflalo",year,".RData")))
load(file = paste0(outPath,paste0("/tacsatEflalo",year,".RData")))
#'----------------------------------------------------------------------------
# 3.1 Create table 2                                                    ----
#'----------------------------------------------------------------------------
# Extract the year and month from the date-time column
eflalo$Year <- year(eflalo$FT_LDATIM)
eflalo$Month <- month(eflalo$FT_LDATIM)
# Set interval to 1 day for later caculation of kwDays
eflalo$INTV <- 1
# Create a record variable for aggregation of records per vessel
eflalo$record <- 1
# Aggregate the dummy variable by VE_COU, VE_REF, and LE_CDAT
res <- aggregate(
eflalo$record,
by = as.list(eflalo[, c("VE_COU", "VE_REF", "LE_CDAT")]),
FUN = sum,
na.rm = TRUE
)
# Rename the columns of the aggregated data frame
colnames(res) <- c("VE_COU", "VE_REF", "LE_CDAT", "nrRecords")
# Merge the aggregated data frame with eflalo
eflalo <- merge(eflalo, res, by = c("VE_COU", "VE_REF", "LE_CDAT"))
# Adjust the interval and calculate kilowatt-days
eflalo$INTV <- eflalo$INTV / eflalo$nrRecords
eflalo$kwDays <- eflalo$VE_KW * eflalo$INTV
# Check if FT_REF is in tacsatp
eflalo$tripInTacsat <- ifelse(eflalo$FT_REF %in% tacsatEflalo$FT_REF, "Y", "N")
# Define the record type
RecordType <- "LE"
# Define the columns to be included in the table
cols <- c(
"VE_REF", "VE_COU", "Year", "Month", "LE_RECT", "LE_GEAR", "LE_MET",
"VE_LEN", "tripInTacsat", "INTV", "kwDays", "LE_KG_TOT", "LE_EURO_TOT"
)
# Create or append to table2 based on the year
if (year == yearsToSubmit[1]) {
table2 <- cbind(RT = RecordType, eflalo[, cols])
} else {
table2 <- rbind(table2, cbind(RT = RecordType, eflalo[, cols]))
}
# Save table2
save(
table2,
file = file.path(outPath, "table2.RData" )
)
message(glue ("Table 2 for year {year} is completed") )
#'----------------------------------------------------------------------------
# 3.2   Create table 1                                                  ----
#'----------------------------------------------------------------------------
tacsatEflalo <- data.frame(tacsatEflalo)
# Define the record type
RecordType <- "VE"
# Define the columns to be included in the table
cols <- c(
"VE_REF", "VE_COU", "Year", "Month", "Csquare", "MSFD_BBHT", "depth", "LE_GEAR",
"LE_MET", "SI_SP", "INTV", "VE_LEN", "kwHour", "VE_KW", "LE_KG_TOT", "LE_EURO_TOT",
"GEARWIDTHKM", "SA_KM2")
# Create or append to table1 based on the year
if (year == yearsToSubmit[1]) {
table1 <- cbind(RT = RecordType, tacsatEflalo[,cols])
} else {
table1 <- rbind(table1, cbind(RT = RecordType, tacsatEflalo[,cols]))
}
# Save
save(
table1,
file = file.path(outPath, "table1.RData" )
)
message(glue("Table 1 for year {year} is completed") )
}
devtools::load_all(".")
#'------------------------------------------------------------------------------
#
# Script to extract and process VMS and logbook data for ICES VMS data call
# 3: Construct and collect tables                                         ----
#
#'------------------------------------------------------------------------------
# Loop through years to submit
for(year in yearsToSubmit){
# load data
load(file = paste0(outPath,paste0("/processedEflalo",year,".RData")))
load(file = paste0(outPath,paste0("/tacsatEflalo",year,".RData")))
#'----------------------------------------------------------------------------
# 3.1 Create table 2                                                    ----
#'----------------------------------------------------------------------------
# Extract the year and month from the date-time column
eflalo$Year <- year(eflalo$FT_LDATIM)
eflalo$Month <- month(eflalo$FT_LDATIM)
# Set interval to 1 day for later caculation of kwDays
eflalo$INTV <- 1
# Create a record variable for aggregation of records per vessel
eflalo$record <- 1
# Aggregate the dummy variable by VE_COU, VE_REF, and LE_CDAT
res <- aggregate(
eflalo$record,
by = as.list(eflalo[, c("VE_COU", "VE_REF", "LE_CDAT")]),
FUN = sum,
na.rm = TRUE
)
# Rename the columns of the aggregated data frame
colnames(res) <- c("VE_COU", "VE_REF", "LE_CDAT", "nrRecords")
# Merge the aggregated data frame with eflalo
eflalo <- merge(eflalo, res, by = c("VE_COU", "VE_REF", "LE_CDAT"))
# Adjust the interval and calculate kilowatt-days
eflalo$INTV <- eflalo$INTV / eflalo$nrRecords
eflalo$kwDays <- eflalo$VE_KW * eflalo$INTV
# Check if FT_REF is in tacsatp
eflalo$tripInTacsat <- ifelse(eflalo$FT_REF %in% tacsatEflalo$FT_REF, "Y", "N")
# Define the record type
RecordType <- "LE"
# Define the columns to be included in the table
cols <- c(
"VE_REF", "VE_COU", "Year", "Month", "LE_RECT", "LE_GEAR", "LE_MET",
"VE_LEN", "tripInTacsat", "INTV", "kwDays", "LE_KG_TOT", "LE_EURO_TOT"
)
# Create or append to table2 based on the year
if (year == yearsToSubmit[1]) {
table2 <- cbind(RT = RecordType, eflalo[, cols])
} else {
table2 <- rbind(table2, cbind(RT = RecordType, eflalo[, cols]))
}
# Save table2
save(
table2,
file = file.path(outPath, "table2.RData" )
)
message(glue ("Table 2 for year {year} is completed") )
#'----------------------------------------------------------------------------
# 3.2   Create table 1                                                  ----
#'----------------------------------------------------------------------------
tacsatEflalo <- data.frame(tacsatEflalo)
# Define the record type
RecordType <- "VE"
# Define the columns to be included in the table
cols <- c(
"VE_REF", "VE_COU", "Year", "Month", "Csquare", "MSFD_BBHT", "depth", "LE_GEAR",
"LE_MET", "SI_SP", "INTV", "VE_LEN", "kwHour", "VE_KW", "LE_KG_TOT", "LE_EURO_TOT",
"GEARWIDTHKM", "SA_KM2")
# Create or append to table1 based on the year
if (year == yearsToSubmit[1]) {
table1 <- cbind(RT = RecordType, tacsatEflalo[,cols])
} else {
table1 <- rbind(table1, cbind(RT = RecordType, tacsatEflalo[,cols]))
}
# Save
save(
table1,
file = file.path(outPath, "table1.RData" )
)
message(glue("Table 1 for year {year} is completed") )
}
