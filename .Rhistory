temperature_range_red_juvI <- temperature_range[-indexes_1095]
#plot( (1:length(dev_time_JUVI_reduced))*0.1,  dev_time_JUVI_reduced, main = "Development days Juvenile \n reduced data" )
fit_juvI <- nls( dev_time_JUVI_reduced ~ ( a + c*exp(-b*temperature_range_red_juvI) ),
start = list(a = 40, c = 3000, b = 1))
a_juvI <- coef(fit_juvI)[1]
b_juvI <- coef(fit_juvI)[3]
c_juvI <- coef(fit_juvI)[2]
#(optional) plot results form fit:
#plot(temperature_range, dev_time_juvI, pch = 1, col = 'gray28', las = 1, xlab = 'T [?C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv I')
#lines(temperature_range_red_juvI, predict(fit_juvI), col = 'lightseagreen', lwd = 2.5)
#### JUVII ####
development_df_juvII <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- juvII_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvII[as.character(i)] <- development
}
dev_time_juvII <- sapply(development_df_juvII, function(col){
count_devDays(col, juvII_min, juvII_max) } )
dev_time_juvII <- dev_time_juvII[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_juvII, main = paste("Development days Juvenile \n with min_size =", juvII_min , "mm and max_size = ", juvII_max ,"mm") )
#Fitting curve for JUVI
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_juvII == 1095)
dev_time_JUVII_reduced <- dev_time_juvII[dev_time_juvII != 1095]
temperature_range_red_juvII <- temperature_range[-indexes_1095]
#length(temperature_range_red_juvI)
#length(dev_time_JUVI_reduced)
#plot( (1:length(dev_time_JUVII_reduced))*0.1,  dev_time_JUVII_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
fit_juvII <- nls( dev_time_JUVII_reduced ~ ( a + c*exp(-b*temperature_range_red_juvII) ),
start = list(a = 20, c = 1500, b = 1))
a_juvII <- coef(fit_juvII)[1]
b_juvII <- coef(fit_juvII)[3]
c_juvII <- coef(fit_juvII)[2]
#(optional) plot results form fit:
#plot(temperature_range, dev_time_juvII, pch = 1, col = 'gray28', las = 1, xlab = 'T [?C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv II')
#lines(temperature_range_red_juvII, predict(fit_juvII), col = 'lightseagreen', lwd = 2.5)
#### JUVIII ####
development_df_juvIII <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- juvIII_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvIII[as.character(i)] <- development
}
dev_time_juvIII <- sapply(development_df_juvIII, function(col){
count_devDays(col, juvIII_min, juvIII_max) } )
dev_time_juvIII <- dev_time_juvIII[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_juvIII, main = paste("Development days Juvenile \n with min_size =", juvIII_min , "mm and max_size = ", juvIII_max ,"mm") )
#Fitting curve for JUVIII
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_juvIII == 1095)
dev_time_juvIII_reduced <- dev_time_juvIII[dev_time_juvIII != 1095]
temperature_range_red_juvIII <- temperature_range[-indexes_1095]
#plot( (1:length(dev_time_juvIII_reduced))*0.1,  dev_time_juvIII_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
fit_juvIII <- nls( dev_time_juvIII_reduced ~ ( a + c*exp(-b*temperature_range_red_juvIII) ),
start = list(a = 20, c = 1500, b = 1))
a_juvIII <- coef(fit_juvIII)[1]
b_juvIII <- coef(fit_juvIII)[3]
c_juvIII <- coef(fit_juvIII)[2]
#(optional) plot results form fit:
#plot(temperature_range, dev_time_juvIII, pch = 1, col = 'gray28', las = 1, xlab = 'T [°C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv III')
#lines(temperature_range_red_juvIII, predict(fit_juvIII), col = 'lightseagreen', lwd = 2.5)
#### JUVIV ####
development_df_juvIV <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- juvIV_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvIV[as.character(i)] <- development
}
dev_time_juvIV <- sapply(development_df_juvIV, function(col){
count_devDays(col, juvIV_min, juvIV_max) } )
dev_time_juvIV <- dev_time_juvIV[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_juvIV, main = paste("Development days Juvenile \n with min_size =", juvIV_min , "mm and max_size = ", juvIV_max ,"mm") )
#Fitting curve for juvIV
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_juvIV == 1095)
dev_time_juvIV_reduced <- dev_time_juvIV[dev_time_juvIV != 1095]
temperature_range_red_juvIV <- temperature_range[-indexes_1095]
#plot( (1:length(dev_time_juvIV_reduced))*0.1,  dev_time_juvIV_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
fit_juvIV <- nls( dev_time_juvIV_reduced ~ ( a + c*exp(-b*temperature_range_red_juvIV) ),
start = list(a = 20, c = 1500, b = 1))
a_juvIV <- coef(fit_juvIV)[1]
b_juvIV <- coef(fit_juvIV)[3]
c_juvIV <- coef(fit_juvIV)[2]
#(optional) plot results form fit:
#plot(temperature_range, dev_time_juvIV, pch = 1, col = 'gray28', las = 1, xlab = 'T [?C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv IV')
#lines(temperature_range_red_juvIV, predict(fit_juvIV), col = 'lightseagreen', lwd = 2.5)
#### juvV ####
development_df_juvV <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- juvV_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvV[as.character(i)] <- development
}
dev_time_juvV <- sapply(development_df_juvV, function(col){
count_devDays(col, juvV_min, juvV_max) } )
dev_time_juvV <- dev_time_juvV[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_juvV, main = paste("Development days Juvenile \n with min_size =", juvV_min , "mm and max_size = ", juvV_max ,"mm") )
#Fitting curve for juvV
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_juvV == 1095)
dev_time_juvV_reduced <- dev_time_juvV[dev_time_juvV != 1095]
temperature_range_red_juvV <- temperature_range[-indexes_1095]
#plot( (1:length(dev_time_juvV_reduced))*0.1,  dev_time_juvV_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
fit_juvV <- nls( dev_time_juvV_reduced ~ ( a + c*exp(-b*temperature_range_red_juvV) ),
start = list(a = 20, c = 1500, b = 1))
a_juvV <- coef(fit_juvV)[1]
b_juvV <- coef(fit_juvV)[3]
c_juvV <- coef(fit_juvV)[2]
#(optional) plot results form fit:
#plot(temperature_range, dev_time_juvV, pch = 1, col = 'gray28', las = 1, xlab = 'T [?C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv V')
#lines(temperature_range_red_juvV, predict(fit_juvV), col = 'lightseagreen', lwd = 2.5)
#### adultI ####
development_df_adultI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- adultI_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_adultI[as.character(i)] <- development
}
dev_time_adultI <- sapply(development_df_adultI, function(col){
count_devDays(col, adultI_min, adultI_max) } )
dev_time_adultI <- dev_time_adultI[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_adultI, main = paste("Development days Juvenile \n with min_size =", adultI_min , "mm and max_size = ", adultI_max ,"mm") )
#Fitting curve for adultI
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_adultI == 1095)
dev_time_adultI_reduced <- dev_time_adultI[dev_time_adultI != 1095]
temperature_range_red_adultI <- temperature_range[-indexes_1095]
#plot( temperature_range_red_adultI,  dev_time_adultI_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
#view <- development_df_adultI['20.8']
#Failed to make a good fit for the U shape, temporary solution:
#ignore all T values from < 20 (because from 20?C dev. time rises again)
temperature_range_redII_adultI <- temperature_range_red_adultI[temperature_range_red_adultI <= 20]
dev_time_adultI_reducedII <- dev_time_adultI_reduced[1: length(temperature_range_redII_adultI)] #as I know that I want to unselect the last values
fitII_adultI <- nls( dev_time_adultI_reducedII ~ ( a + c*exp(-b*temperature_range_redII_adultI) ),
start = list(a = 100, c = 3000, b = 1))
a_adultI <- coef(fitII_adultI)[1]
b_adultI <- coef(fitII_adultI)[3]
c_adultI <- coef(fitII_adultI)[2]
#plot(temperature_range, dev_time_adultI, pch = 1, col = 'gray28', las = 1, xlab = 'T [°C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Adult I')
#lines(temperature_range_redII_adultI, predict(fitII_adultI), col = 'lightseagreen', lwd = 2.5)
#plot(temperature_range, 1/dev_time_adultI, pch = 1, col = 'gray28', las = 1, xlab = 'T [°C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Adult I')
#Shifts of Biomass function
shift_next_sizeClass = function(Te, sizeClass){
ratio = 0
if (Te <= 0) {
return (0)
} else {
if (sizeClass == 'juvI'){
a = 11.73753
b = 2.205524
c = 1747.899
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvII'){
a = coef(fit_juvII)[1]
b = coef(fit_juvII)[3]
c = coef(fit_juvII)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvIII'){
a = coef(fit_juvIII)[1]
b = coef(fit_juvIII)[3]
c = coef(fit_juvIII)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvIV'){
a = coef(fit_juvIV)[1]
b = coef(fit_juvIV)[3]
c = coef(fit_juvIV)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvV'){
a = coef(fit_juvV)[1]
b = coef(fit_juvV)[3]
c = coef(fit_juvV)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'adultI'){
a = coef(fitII_adultI)[1]
b = coef(fitII_adultI)[2]
c = coef(fitII_adultI)[3]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'egg'){
ratio = 1/ (1031.34*Te^-1.345)
}
if (sizeClass == 'larv' ){
ratio = 1 / ((5.5/0.00584)*Te^-1.347)
}
return (ratio)
}
}
the.method = 'rk4'
h = 0.2 # half saturatuion constant original aprox .5
L_inf = 8.5
epsilon = 0.22
m = 3
const_c = 0.01 # reference density g/cm3
t = seq(0,length(temperature_10_11$temperature)-0.1, by = 0.1)
t_5years = seq(0,length(temperature_10_14$temperature)-0.1, by = 0.1)
state = c(P = 2, E = 0.1, L= 0.4 , J = .4 , J2 = 0.3, J3 = 0.3, J4 = 0.2, J5 = 0.2, A1 = 0.35, A2 = 0.1)
#state = c(P = 100, E = 2, L= 40 , J = 70 , J2 = 50, A2 = 40)
parameters = c()
state2 <- c(P = 2, E = 0.1, L= 0.4 , J = .175 , J2 = 0.125, J3 = 0.125, J4 = 0.1, J5 = 0.1, A1 = 0.35, A2 = 0.1)
start <- Sys.time()
cc_2 <- solver_sizeClass_extended(t = t_5years, state = state2, parameters = parameters, temperature_10_14)
print(Sys.time() - start)
start_date <- as.POSIXct("2010-01-01", format="%Y-%m-%d", tz = "UTC")
cc_2 <- mutate(cc_2, dateTime = start_date + cc_2$time * 86400) #86400 seconds in one day
cc_2 <- cc_2[ , -1] # delete timesteps column
#cc_long_2 <- gather(cc_2, key = "Type", value = "Value", P, E, L, J, J2, J3, J4, J5, A1, A2)
cc_2_long <- cc_2 %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
ggplot(cc_2_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " extended size classes aprox. each 10 mm \n 2010-2014 ", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,"J" = "#bfd3e6", "J2" = "#9ebcda", "J3" = "#8c96c6", "J4" = "#8856a7", "J5" = "#810f7c" ,
"A1" = "#fd8d3c" ,"A2" = "#e6550d" )) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom") + ylim(0,2)
ggplot(cc_2_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " extended size classes aprox. each 10 mm \n 2010-2014 ", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,"J" = "#bfd3e6", "J2" = "#9ebcda", "J3" = "#8c96c6", "J4" = "#8856a7", "J5" = "#810f7c" ,
"A1" = "#fd8d3c" ,"A2" = "#e6550d" )) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom")
ggplot(cc_2_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " extended size classes aprox. each 10 mm \n 2010-2014 ", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,"J" = "#bfd3e6", "J2" = "#9ebcda", "J3" = "#8c96c6", "J4" = "#8856a7", "J5" = "#810f7c" ,
"A1" = "#fd8d3c" ,"A2" = "#e6550d" )) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom") + ylim(0,20)
ggplot(cc_2_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " extended size classes aprox. each 10 mm \n 2010-2014 ", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,"J" = "#bfd3e6", "J2" = "#9ebcda", "J3" = "#8c96c6", "J4" = "#8856a7", "J5" = "#810f7c" ,
"A1" = "#fd8d3c" ,"A2" = "#e6550d" )) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom") + ylim(0,50)
ggplot(cc_2_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " extended size classes aprox. each 10 mm \n 2010-2014 ", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,"J" = "#bfd3e6", "J2" = "#9ebcda", "J3" = "#8c96c6", "J4" = "#8856a7", "J5" = "#810f7c" ,
"A1" = "#fd8d3c" ,"A2" = "#e6550d" )) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom") + ylim(0,100)
df_long2 <- cc_2[ ,-1] %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
# Calculate total at each time point and normalize to proportions
#df_long$Date <- as.Date(df$time, origin = "01/01/2010")  # If time starts at 0 "31/12/2009"
#ensure that vertical order is same as life stages
stack_order <- rev(c(colnames(cc_2)[2:10]) ) #rev(c(names(df_long_prev)[2:10], 'sum_all') )
# Ensure 'variable' is a factor with levels in the same order
df_long2$variable <- factor(df_long2$variable, levels = stack_order)
#dev.off()
ggplot(df_long2, aes(x = dateTime, y = value, fill = variable)) +
geom_area() +
scale_fill_viridis_d() +
labs(
title = "",
x = "Date",
y = "Biomass",
fill = "Size class"
) + ylim(0, 850)
library(BrownShrimp)
#APPROACH: to compare and if applicable, to adapt own spawning function to Temings result.
#For all simulations, I will consider a constant number of females (100) with an specific size (6 cm)
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_90 <- temperature_func(temperature_dataSet, "01/01/1990", "31/12/1990")
temperature_85 <- temperature_func(temperature_dataSet, "01/01/1985", "31/12/1985")
#### some constants needed ####
the.method = 'rk4'
m = 3 # ww-lenght scaling exponent
n = 3/4
const_c = 0.01 # reference density g/cm3
#L_inf = 8.5 #cm
#a = 0.008 #
#epsilon = 0.22
avg_weight_egg = 18.e-6 #~avg 18 microgramm over the year (from table from seasonal changes on eggs Urzua)
temp_range = seq(0,30, 0.1)
#TEMING
# SI = C_l * E_l * EF_l * MF_l
# c_l: number of individuals per a size class 'l'
# E_l: Share of egg-bearing Fem in size class 'l'
# EF_l: mean number of eggs per size class
# MF_l: molting frequency
fem_abundance <- 100 #number of females (we will consider first also a constant size L=6 cm)
L_test1 <- 6 #cm
number_eggs <- function(L){
0.01805*L^3.539 #incongruency on Temming's paper weather 0.01805 or 0.001805. The first seem more plausible for me
}
eggs_production_temming <- c()
eggs_production_AF <- c()
for (i in temp_range){
prod_temming <- fem_abundance*molting_fraction(L_test1, i)*number_eggs(L_test1*10)
B_fe = convertL_to_W(6)
prod_AF <- B_fe*fem_abundance*molting_fraction(L_test1, i)*spawning_rate(L_test1, i)/epsilon
eggs_production_temming <- append(eggs_production_temming, prod_temming) #number of eggs
eggs_production_AF <- append(eggs_production_AF, prod_AF) #biomass
}
epsilon = 0.22
avg_weight_egg = 18.e-6 #~avg 18 microgramm over the year (from table from seasonal changes on eggs Urzua)
temp_range = seq(0,30, 0.1)
#TEMING
# SI = C_l * E_l * EF_l * MF_l
# c_l: number of individuals per a size class 'l'
# E_l: Share of egg-bearing Fem in size class 'l'
# EF_l: mean number of eggs per size class
# MF_l: molting frequency
fem_abundance <- 100 #number of females (we will consider first also a constant size L=6 cm)
L_test1 <- 6 #cm
number_eggs <- function(L){
0.01805*L^3.539 #incongruency on Temming's paper weather 0.01805 or 0.001805. The first seem more plausible for me
}
eggs_production_temming <- c()
eggs_production_AF <- c()
for (i in temp_range){
prod_temming <- fem_abundance*molting_fraction(L_test1, i)*number_eggs(L_test1*10)
B_fe = convertL_to_W(6)
prod_AF <- B_fe*fem_abundance*molting_fraction(L_test1, i)*spawning_rate(L_test1, i)/epsilon
eggs_production_temming <- append(eggs_production_temming, prod_temming) #number of eggs
eggs_production_AF <- append(eggs_production_AF, prod_AF) #biomass
}
plot(temp_range, eggs_production_temming, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Number Eggs')
library(BrownShrimp)
#APPROACH: to compare and if applicable, to adapt own spawning function to Temings result.
#For all simulations, I will consider a constant number of females (100) with an specific size (6 cm)
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_90 <- temperature_func(temperature_dataSet, "01/01/1990", "31/12/1990")
temperature_85 <- temperature_func(temperature_dataSet, "01/01/1985", "31/12/1985")
#### some constants needed ####
the.method = 'rk4'
m = 3 # ww-lenght scaling exponent
n = 3/4
const_c = 0.01 # reference density g/cm3
#L_inf = 8.5 #cm
#a = 0.008 #
epsilon = 0.22
avg_weight_egg = 18.e-6 #~avg 18 microgramm over the year (from table from seasonal changes on eggs Urzua)
temp_range = seq(0,30, 0.1)
fem_abundance <- 100 #number of females (we will consider first also a constant size L=6 cm)
L_test1 <- 6 #cm
#TEMING
# SI = C_l * E_l * EF_l * MF_l
# c_l: number of individuals per a size class 'l'
# E_l: Share of egg-bearing Fem in size class 'l'
# EF_l: mean number of eggs per size class
# MF_l: molting frequency
number_eggs <- function(L){
0.01805*L^3.539 #incongruency on Temming's paper weather 0.01805 or 0.001805. The first seem more plausible for me
}
#### SIMULATIONS ####
eggs_production_temming <- c()
eggs_production_AF <- c()
for (i in temp_range){
prod_temming <- fem_abundance*molting_fraction(L_test1, i)*number_eggs(L_test1*10)
B_fe = convertL_to_W(6)
prod_AF <- B_fe*fem_abundance*molting_fraction(L_test1, i)*spawning_rate(L_test1, i)/epsilon
eggs_production_temming <- append(eggs_production_temming, prod_temming) #number of eggs
eggs_production_AF <- append(eggs_production_AF, prod_AF) #biomass
}
plot(temp_range, eggs_production_temming, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Number Eggs')
Teming_biomass = eggs_production_temming*avg_weight_egg
plot(temp_range, eggs_production_temming*avg_weight_egg, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Biomass')
lines(temp_range, eggs_production_AF*artificial_factor, col = 'orangered3', lwd = 2)
plot(temp_range, eggs_production_temming*avg_weight_egg, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Biomass')
lines(temp_range, eggs_production_AF, col = 'orangered3', lwd = 2)
Teming_biomass = eggs_production_temming*avg_weight_egg
plot(temp_range, eggs_production_temming*avg_weight_egg, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Biomass')
lines(temp_range, eggs_production_AF, col = 'orangered3', lwd = 2)
library(BrownShrimp)
#APPROACH: to compare and if applicable, to adapt own spawning function to Temings result.
#For all simulations, I will consider a constant number of females (100) with an specific size (6 cm)
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_90 <- temperature_func(temperature_dataSet, "01/01/1990", "31/12/1990")
temperature_85 <- temperature_func(temperature_dataSet, "01/01/1985", "31/12/1985")
#### some constants needed ####
the.method = 'rk4'
m = 3 # ww-lenght scaling exponent
n = 3/4
const_c = 0.01 # reference density g/cm3
#L_inf = 8.5 #cm
#a = 0.008 #
epsilon = 0.22
avg_weight_egg = 18.e-6 #~avg 18 microgramm over the year (from table from seasonal changes on eggs Urzua)
temp_range = seq(0,30, 0.1)
fem_abundance <- 100 #number of females (we will consider first also a constant size L=6 cm)
L_test1 <- 6 #cm
#TEMING
# SI = C_l * E_l * EF_l * MF_l
# c_l: number of individuals per a size class 'l'
# E_l: Share of egg-bearing Fem in size class 'l'
# EF_l: mean number of eggs per size class
# MF_l: molting frequency
number_eggs <- function(L){
0.01805*L^3.539 #incongruency on Temming's paper weather 0.01805 or 0.001805. The first seem more plausible for me
}
#### SIMULATIONS ####
eggs_production_temming <- c()
eggs_production_AF <- c()
for (i in temp_range){
prod_temming <- fem_abundance*molting_fraction(L_test1, i)*number_eggs(L_test1*10)
B_fe = convertL_to_W(6)
prod_AF <- B_fe*fem_abundance*molting_fraction(L_test1, i)*spawning_rate(L_test1, i)/epsilon
eggs_production_temming <- append(eggs_production_temming, prod_temming) #number of eggs
eggs_production_AF <- append(eggs_production_AF, prod_AF) #biomass
}
plot(temp_range, eggs_production_temming, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Number Eggs')
#Now plot to compare biomass
Teming_biomass = eggs_production_temming*avg_weight_egg
plot(temp_range, eggs_production_temming*avg_weight_egg, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Biomass')
lines(temp_range, eggs_production_AF, col = 'orangered3', lwd = 2)
head(eggs_production_AF)
eggs_production_temming <- c()
eggs_production_AF <- c()
initial_spawning_rate <- function(L, temperature){
s = 0
if(L>5) s = convertL_to_W(L)*K_func(temperature)*3*epsilon #molting_fraction(L*10, T) * convertL_to_W(L)*K_func(T)*3*epsilon #here L for Temming in mm
return(s)
}
for (i in temp_range){
prod_temming <- fem_abundance*molting_fraction(L_test1, i)*number_eggs(L_test1*10)
B_fe = convertL_to_W(6)
prod_AF <- B_fe*fem_abundance*molting_fraction(L_test1, i)*initial_spawning_function(L_test1, i)/epsilon
eggs_production_temming <- append(eggs_production_temming, prod_temming) #number of eggs
eggs_production_AF <- append(eggs_production_AF, prod_AF) #biomass
}
for (i in temp_range){
prod_temming <- fem_abundance*molting_fraction(L_test1, i)*number_eggs(L_test1*10)
B_fe = convertL_to_W(6)
prod_AF <- B_fe*fem_abundance*molting_fraction(L_test1, i)*initial_spawning_rate(L_test1, i)/epsilon
eggs_production_temming <- append(eggs_production_temming, prod_temming) #number of eggs
eggs_production_AF <- append(eggs_production_AF, prod_AF) #biomass
}
plot(temp_range, eggs_production_temming*avg_weight_egg, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Biomass')
lines(temp_range, eggs_production_AF, col = 'orangered3', lwd = 2)
fit <- lm(Teming_biomass[1:163] ~ eggs_production_AF[1:163])
summary(fit)
fit <- lm(Teming_biomass[1:163] ~ eggs_production_AF[1:163])
summary(fit)
intercept = 3.54616
factor = 4.40332
plot(temp_range, eggs_production_temming*avg_weight_egg, main = "Temming vs AF fitted \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Biomass')
lines(temp_range, intercept + eggs_production_AF*factor, col = 'orangered3', lwd = 2)
sizes = c(5.5, 6.5, 7.5, 8.5)
sp_g = spawning_rate(5.5, temp_range)
plot(temp_range, sp_g, main = 'Spawning rate with temperature changes')
spG_90 = spawning_rate(5.5, temperature_90$temperature)
plot(temperature_90$date_time, spG_90, main = 'Spawning rate with temperature data from 1990',
type = 'l', col = '#33638DFF')
