prod <- fem_abundance*molting_fraction(L_test1*10, i)*number_eggs(L_test1)
eggs_production <- append(eggs_production, prod)
}
plot(temp_range, eggs_production, main = "Temming egg production with constant T and for L=6cm")
number_eggs <- function(L){
0.01805*L^3.539
}
eggs_production <- c()
for (i in temp_range){
prod <- fem_abundance*molting_fraction(L_test1*10, i)*number_eggs(L_test1)
eggs_production <- append(eggs_production, prod)
}
plot(temp_range, eggs_production, main = "Temming egg production with constant T and for L=6cm")
plot(temp_range, eggs_production, main = "Temming egg production of 100Fems \n with constant T and for L=6cm")
plot(temp_range, eggs_production_temming, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Number Eggs (T)/ Biomass(AF)')
fem_abundance <- 100 #number of females (we will consider first also a constant size L=6 cm)
L_test1 <- 6
number_eggs <- function(L){
0.01805*L^3.539 #incongruency on Temming's paper weather 0.01805 or 0.001805. The first seem more plausible for me
}
eggs_production_temming <- c()
eggs_production_AF <- c()
for (i in temp_range){
prod_temming <- fem_abundance*molting_fraction(L_test1*10, i)*number_eggs(L_test1)
prod_AF <- fem_abundance*spawning_rate(L_test1, i)
eggs_production_temming <- append(eggs_production_temming, prod_temming)
eggs_production_AF <- append(eggs_production_AF, prod_AF)
}
plot(temp_range, eggs_production_temming, main = "Temming egg production of 100Fems \n with constant T and for L=6cm",
xlab = 'T', ylab = 'Number Eggs (T)/ Biomass(AF)')
lines(temp_range, eggs_production_AF, col = 'orangered3',type = 'l' )
#lines(temp_range, eggs_production_AF, col = 'orangered3',type = 'l' )
plot(temp_range, eggs_production_AF, col = 'orangered3',type = 'l' )
#lines(temp_range, eggs_production_AF, col = 'orangered3',type = 'l' )
plot(temp_range, eggs_production_AF, col = 'orangered3',type = 'l', main = 'Spawning Thesis Model' )
#lines(temp_range, eggs_production_AF, col = 'orangered3',type = 'l' )
plot(temp_range, eggs_production_AF, col = 'orangered3',type = 'l', lwd = 2, main = 'Spawning Thesis Model' )
#lines(temp_range, eggs_production_AF, col = 'orangered3',type = 'l' )
plot(temp_range, eggs_production_AF, col = 'orangered3', lwd = 2, main = 'Spawning Thesis Model' )
#lines(temp_range, eggs_production_AF, col = 'orangered3',type = 'l' )
plot(temp_range, eggs_production_AF, col = 'orangered3', lwd = 2, main = 'Spawning Thesis Model',
ylab = 'Biomass eggs produced / day')
plot(temp_range, sapply(temp_range, som_growthAF, 0.8, 'F'))
temp_range <- seq(1,30, 0.1)
plot(temp_range, sapply(temp_range, som_growthAF, 0.8, 'F'))
library(dplyr)
library(ggplot2)
library(cowplot) #for combined plots
library(RColorBrewer)
library(deSolve)
library(patchwork)
library(minpack.lm)
library(BrownShrimp)
### UPLOAD AND FORMAT TEMPERATURE DATA ###
temperature_ds <- read.csv("C:/Users/andre/Desktop/Hereon/Data/Wadden Sea, Penning/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
#temperature_00_01 <- temperature_func(temperature_ds, "01/01/2000", "31/12/2001")
#temperature_05_06 <- temperature_func(temperature_ds, "01/01/2005", "31/12/2006")
#temperature_10_11 <- temperature_func(temperature_ds, "01/01/2010", "31/12/2011")
temperature_15_16 <- temperature_func(temperature_ds, "01/01/2015", "31/12/2016")
#temperature_17_18 <- temperature_func(temperature_ds, "01/01/2017", "31/12/2018")
#For the time being I will only work with data from 2010 and 2011.
#### EGG DEVELOPMENT #####
egg_development_array <- c()
hatch_status_array <- c()
initial_status_egg <- 0
#first_day_egg <- egg_dev(initial_status_egg, temperature_15_16$temperature[1])
#initial_status_egg <- first_day_egg[[1]]
for (i in 1:length(temperature_15_16$temperature) ){
egg_development <- egg_dev(initial_status_egg, temperature_15_16$temperature[i])
initial_status_egg <- egg_development[[1]]
hatch_status_array <- append(hatch_status_array, egg_development[[2]] )
egg_development_array <- append(egg_development_array, initial_status_egg)
}
#### SOMATIC GROWTH (FROM 6 MM) ####
temperature_range <- seq(0, 30, 0.1)
days <- seq(1, length(temperature_15_16$temperature))
L_as_f <- 85 #mm
L_as_m <- 55 #mm
#FEMALES
#STEP(1) Temmings simulations with constant temperatures
# create an empty DF for each temperature degree.
growth_fem <- data.frame(days=seq(1, length(temperature_15_16$temperature)))
for (j in temperature_range){
initial_l <- 6 #mm
development <- c()
for (i in 1:length(temperature_15_16$temperature)) {
new_legth <- som_growth(initial_l, j, L_as_f, 'F')
development <- append(development, new_legth)#c(growth_fem[[ind]], new_legth) #append the new length
initial_l <- new_legth
}
growth_fem[as.character(j)] <- development
}
#STEP(2) Fit Bertalanffy eq. to female simulation
K_estimations_f <- c()
all_fits_fem <- list()
for (i in 1:length(temperature_range)){
#teperature.char <-
set_toFit <- pull(growth_fem, as.character(temperature_range[i]))
fit <- nls( set_toFit ~ ( L_as_f * (1 - exp(-k * days)) ),
start = list(k = 0.5))
all_fits_fem <- c(all_fits_fem, list(fit) )
K_estimations_f <- append(K_estimations_f, coef(fit)["k"])
}
head(K_estimations_f)
length(K_estimations_f)
#STEP(3) plot to see the shape of the curve:
plot(temperature_range, K_estimations_f, main='K estiations female')
T_opt <- which.max(K_estimations_f)*0.1 #this is the T_opt
#MALES
#STEP(1) Temmings simulations with constant temperatures
growth_masc <- data.frame(days=seq(1, length(temperature_15_16$temperature)))
for (j in temperature_range){
initial_l <- 6 #mm
development <- c()
for (i in 1:length(temperature_15_16$temperature)) {
new_legth <- som_growth(initial_l, j, L_as_m, 'M')
development <- append(development, new_legth)#c(growth_fem[[ind]], new_legth) #append the new length
initial_l <- new_legth
}
growth_masc[as.character(j)] <- development
}
#STEP(2) Fit Bertalanffy eq. to female simulation
K_estimations_m <- c()
all_fits_masc <- list()
for (i in 1:length(temperature_range)){
#teperature.char <-
set_toFit <- pull(growth_masc, as.character(temperature_range[i]))
fit <- nls( set_toFit ~ ( L_as_m * (1 - exp(-k * days)) ),
start = list(k = 0.5))
all_fits_masc <- c(all_fits_masc, list(fit) )
K_estimations_m <- append(K_estimations_m, coef(fit)["k"])
}
head(K_estimations_m)
length(K_estimations_m)
#STEP(3) plot to see the shape of the curve:
plot(temperature_range, K_estimations_m, main='K estiations male')
#### STEP (4) Now apply regression to K-values 'curve' with gaussian distribution (F and M): ####
#Fem
fit_gaus_f <- nls(K_estimations_f ~  A * exp(-((temperature_range - mu)^2) / (2 * sigma^2)),
start = list(A = 0.0072, mu = 17, sigma = 1), trace = TRUE)
summary(fit_gaus_f)
#Detemine the goodness of the fit:
# Calculate residual sum of squares (RSS)
RSS_f <- sum((K_estimations_f - predict(fit_gaus_f))^2)
# Calculate total sum of squares (TSS)
TSS_f <- sum((K_estimations_f - mean(K_estimations_f))^2)
# Calculate R-squared
RSQ_gauss_f <- 1 - (RSS_f / TSS_f)
cat("R-squared: ", RSQ_gauss_f, "\n")
#Masc
fit_gaus_m <- nls(K_estimations_m ~  A * exp(-((temperature_range - mu)^2) / (2 * sigma^2)),
start = list(A = 0.016, mu = 21, sigma = 0.8), trace = TRUE)
summary(fit_gaus_m)
#plot(temperature_range, K_estimations_f)
#lines(temperature_range, predict(fit_gaus_f))
#Detemine the goodness of the fit:
# Calculate residual sum of squares (RSS)
RSS_m <- sum((K_estimations_m - predict(fit_gaus_m))^2)
# Calculate total sum of squares (TSS)
TSS_m <- sum((K_estimations_m - mean(K_estimations_m))^2)
# Calculate R-squared
RSQ_gauss_m <- 1 - (RSS_m / TSS_m)
cat("R-squared: ", RSQ_gauss_m, "\n")
dev.off()
plot(temperature_range, K_estimations_m, main = 'K - values M and F for each degree °C \n vs Fit Gauss', col = 'steelblue4',
xlab = 'Temperature (?C)', ylab = 'K', cex.lab = 1.7, cex.main = 1.6, las = 1, lwd = 2)
points(temperature_range,K_estimations_f, col = 'orangered4', lwd = 2)
lines(temperature_range, predict(fit_gaus_f), col = 'lightsalmon2', lwd = 2)
lines(temperature_range, predict(fit_gaus_m), col = 'lightseagreen', lwd = 2)
legend("topleft",
legend = c("Male", "Female", 'Fit M', 'Fit F'),
col = c("steelblue4", "orangered4", 'lightseagreen', 'lightsalmon2'),
lty = c(NA, NA, 1, 1),
pch = c(16,16,NA, NA),
cex = 1.25)
#### STEP (4) Again with TPC Briere instead of Gauss (F and M): ####
#TPC: Termal Performance Curve
T_min = 0.4
T_max = 30
T_range = seq(T_min, T_max, by= 0.1)
#Fem
K_estimations_f_df<- data.frame(
temperature = temperature_range,
performance = K_estimations_f
)
K_estimations_f_df_filtered <- subset(K_estimations_f_df, temperature > T_min & temperature < T_max) #the fit can be applied only to data within Temperature range!
fit_briere_f <- nlsLM(performance ~  c*temperature*(temperature - T_min_f)*((T_max_f - temperature)^(1/m) ),
data = K_estimations_f_df_filtered,
start = list(c = 0.000000001, T_min_f = 1, T_max_f = 35, m = 0.4),
lower = c(c = 0, T_min_f = 0, T_max_f = 15, m = 0.05),
upper = c(c = 0.1, T_min_f = 1, T_max_f = 40, m = 2),
control = nls.lm.control(maxiter = 500) )
summary(fit_briere_f)
RSS_f_b <- sum((K_estimations_f_df_filtered$performance - predict(fit_briere_f))^2)
# Calculate total sum of squares (TSS)
TSS_f_b <- sum((K_estimations_f_df_filtered$performance - mean(K_estimations_f_df_filtered$performance))^2)
RSQ_f_briere <- 1 - (RSS_f_b / TSS_f_b)
cat("R-squared: ", RSQ_f_briere, "\n")
#Masc
K_estimations_m_df<- data.frame(
temperature = temperature_range,
performance = K_estimations_m
)
K_estimations_m_df_filtered <- subset(K_estimations_m_df, temperature > T_min & temperature < T_max)  #the fit can be applied only to data within Temperature range!
fit_briere_m <- nlsLM(performance ~  c*temperature*(temperature - T_min_f)*((T_max_f - temperature)^(1/m) ),
data = K_estimations_m_df_filtered,
start = list(c = 0.000000001, T_min_f = 1, T_max_f = 35, m = 0.4),
lower = c(c = 0, T_min_f = 0, T_max_f = 15, m = 0.05),
upper = c(c = 0.1, T_min_f = 1, T_max_f = 40, m = 2),
control = nls.lm.control(maxiter = 500) )
summary(fit_briere_m)
RSS_m_b <- sum((K_estimations_m_df_filtered$performance - predict(fit_briere_m))^2)
# Calculate total sum of squares (TSS)
TSS_m_b <- sum((K_estimations_m_df_filtered$performance - mean(K_estimations_m_df_filtered$performance))^2)
RSQ_m_briere <- 1 - (RSS_m_b / TSS_m_b)
cat("R-squared: ", RSQ_m_briere, "\n")
plot(temperature_range, K_estimations_m, main = 'K - values M and F for each degree °C \n vs Fit Briere', col = 'steelblue4',
xlab = 'Temperature (°C)', ylab = 'K', cex.lab = 1.7, cex.main = 1.6, las = 1, lwd = 2)
points(temperature_range,K_estimations_f, col = 'orangered4', lwd = 2)
lines(K_estimations_f_df_filtered$temperature, predict(fit_briere_f), col = 'lightsalmon2', lwd = 2)
lines(K_estimations_m_df_filtered$temperature, predict(fit_briere_m), col = 'lightseagreen', lwd = 2)
legend("topleft",
legend = c("Male", "Female", 'Fit M', 'Fit F'),
col = c("steelblue4", "orangered4", 'lightseagreen', 'lightsalmon2'),
lty = c(NA, NA, 1, 1),
pch = c(16,16,NA, NA),
cex = 1.25)
#### STEP (4) Again with flexTPC Briere (F and M): ####
# FEMALE
r_max_f = max(K_estimations_f_df_filtered$performance)
fit_flexBriere_f <- nlsLM( performance ~  r_max_f*( (((temperature - T_min)/alpha)^alpha) * (((T_max - temperature)/ (1-alpha) )^(1-alpha)) * (1 / (T_max- T_min))  )^(alpha*(1-alpha)/beta^2) ,
data = K_estimations_f_df_filtered,
start = list(alpha = 0.5, beta = 0.25 ),
lower = c(alpha = 0 , beta = 0.05),
upper = c(alpha = 1, beta = 1),
control = nls.lm.control(maxiter = 500) )
summary(fit_flexBriere_f)
RSS_f_fb <- sum((K_estimations_f_df_filtered$performance - predict(fit_flexBriere_f))^2)
# Calculate total sum of squares (TSS)
TSS_f_fb <- sum((K_estimations_f_df_filtered$performance - mean(K_estimations_f_df_filtered$performance))^2)
RSQ_f_flexBriere <- 1 - (RSS_f_fb / TSS_f_fb)
cat("R-squared: ", RSQ_f_flexBriere, "\n")
# MALE
r_max_m = max(K_estimations_m_df_filtered$performance)
fit_flexBriere_m <- nlsLM( performance ~  r_max_m*( (((temperature - T_min)/alpha)^alpha) * (((T_max - temperature)/ (1-alpha) )^(1-alpha)) * (1 / (T_max- T_min))  )^(alpha*(1-alpha)/beta^2) ,
data = K_estimations_m_df_filtered,
start = list(alpha = 0.5, beta = 0.25 ),
lower = c(alpha = 0 , beta = 0.05),
upper = c(alpha = 1, beta = 1),
control = nls.lm.control(maxiter = 500) )
summary(fit_flexBriere_m)
RSS_m_fb <- sum((K_estimations_m_df_filtered$performance - predict(fit_flexBriere_m))^2)
# Calculate total sum of squares (TSS)
TSS_m_fb <- sum((K_estimations_m_df_filtered$performance - mean(K_estimations_m_df_filtered$performance))^2)
RSQ_m_felBriere <- 1 - (RSS_m_fb / TSS_m_fb)
cat("R-squared: ", RSQ_m_felBriere, "\n")
plot(temperature_range, K_estimations_m, main = 'K - values M and F for each degree °C \n vs Fit felxBriere', col = 'steelblue4',
xlab = 'Temperature (°C)', ylab = 'K', cex.lab = 1.7, cex.main = 1.6, las = 1, lwd = 2)
points(temperature_range,K_estimations_f, col = 'orangered4', lwd = 2)
lines(K_estimations_f_df_filtered$temperature, predict(fit_flexBriere_f), col = 'lightsalmon2', lwd = 2)
lines(K_estimations_m_df_filtered$temperature, predict(fit_flexBriere_m), col = 'lightseagreen', lwd = 2)
legend("topleft",
legend = c("Male", "Female", 'Fit M', 'Fit F'),
col = c("steelblue4", "orangered4", 'lightseagreen', 'lightsalmon2'),
lty = c(NA, NA, 1, 1),
pch = c(16,16,NA, NA),
cex = 1.25)
func_K_briere <- function(temperature) { #refers for the time being only females
r_max_f = 0.007638409
T_min = 0.4
T_max = 30
alpha = 0.541524
beta = 0.276430
diff_min = temperature - T_min
diff_max = T_max - temperature
diff = T_max - T_min
alpha_invert = 1 - alpha
return(r_max_f*( ((diff_min/alpha)^alpha) * ((diff_max/ alpha_invert )^alpha_invert) * (1 / diff)  )^(alpha*alpha_invert/(beta^2) ))
}
# Define the system of equations (solver for dl/dt)
temperature_15_17 <- temperature_func(temperature_ds, "01/01/2015", "31/12/2017")
system.equations <- function(t, state, parameters) {
with(as.list(c(state, parameters)), {
if (sex=='F'){
L_as = 85
} else if (sex=='M'){
L_as = 55
} else {
stop("Invalid sex value: Please ensure 'sex' is either 'F' or 'M'.")
}
K <- func_K_briere(temperature_15_17$temperature[floor(t)])  # Access temperature for the current time
dl.dt <- K * (L_as - l)  # Differential equation
return(list(dl.dt))  # Return the rate of change
})
}
t2 = seq(1, 730, 0.01)
t3 = seq(1, 1095, 0.01)
##Simulation Fem
parameters <- list(sex='F')
cc_f_b <- ode(y = state, times = t3, func = system.equations, parms = parameters)# Solve the ODE
t <- seq(1, 364, 0.01)
# Initial state for l
state <- c(l = 6)  #
parameters <- list(sex='F')
t2 = seq(1, 730, 0.01)
t3 = seq(1, 1095, 0.01)
##Simulation Fem
parameters <- list(sex='F')
cc_f_b <- ode(y = state, times = t3, func = system.equations, parms = parameters)# Solve the ODE
cc_f_b <- as.data.frame(cc_f_b)
head(cc_f_b)
temming_growth_f <- c()
temming_growth_m <- c()
L_as_f <- 85
L_as_m <- 55
#simulation female
initial_size <- 6 #mm
for (i in 1:length(temperature_15_17$date_time) ){
development_Temming <- som_growth(initial_size, temperature_15_17$temperature[i], L_as_f ,"F")
initial_size <- development_Temming
temming_growth_f <- append(temming_growth_f, development_Temming)
}
##Plot Fem
female_plot_b <- ggplot() +
geom_point(aes(x = 1: length(temperature_15_17$temperature), y = temming_growth_f, color = "Empirical function"),
size = 2, shape = 21, fill = "gray") +  # Use points for temperature growth data
geom_line(aes(x = cc_f_b$time, y = cc_f_b$l, color = "Analytical model"),
size = 0.75) +  # Line for cc_f
labs(x = "Day of Year", y = "Length (mm)", title = "Female Growth") +
scale_color_manual(name = "Legend",
values = c("Empirical function" = "gray" , "Analytical model" = "maroon3") )+
#labels = c("Empiric", "Analytical")) +
theme_minimal() +
theme(
legend.text = element_text(size = 14),   # Increase legend text size
legend.title = element_text(size = 14),  # Increase legend title size
axis.title.x = element_text(size = 14),  # Increase x-axis title size
axis.title.y = element_text(size = 14),  # Increase y-axis title size
plot.title = element_text(size = 16, hjust = 0.5) # Increase title size and center it
)
print(female_plot_b)
#Here I will check plausibility of individual funciton that are used in the model
#### Some params ####
temp_range = seq(1,30, 0.1)
the.method = 'rk4'
h = 0.2 # half saturatuion constant original aprox .5
L_inf = 8.5
epsilon = 0.22
m = 3
const_c = 0.01
#### CHECK K FUNC ####
#SEE K-FUNC GAUSS VS TPC
plot(temp_range, sapply(temp_range, K_func), type = "b", col = "blue",
xlab = "Temperature (°C)", ylab = "K(T)",
main = "K func Gauss vs Briere")
lines(temp_range, sapply(temp_range, K_func_briere), type = "b", col = 'red' , cex = 0.5)
legend("topright", legend = c("Gauss", "Briere"), col = c("blue", "red"), lty = 1, pch = 1)
devtools::load_all(".")
library(dplyr)
library(ggplot2)
library(cowplot) #for combined plots
library(RColorBrewer)
library("colorspace")
library(deSolve)
library(tidyr)
library(RColorBrewer)
library(BrownShrimp)
library(viridis)
library(devtools)
#UPLOAD TEMPERATURE DATA
temperature_dataSet <- read.csv("C:/Users/andre/Desktop/Hereon/Data/Wadden Sea, Penning/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_10_11 <- temperature_func(temperature_dataSet, "01/01/2010", "31/12/2011")
temperature_10_14 <- temperature_func(temperature_dataSet, "01/01/2010", "31/12/2014")
######### START ###########
#Def. Size Classes ranges [cm]
L_as_F <- 8.5
juvI_min <- .6
juvI_max <- 1.0
juvII_min  <- 1.0
juvII_max <- 2.0
juvIII_min  <- 2.0
juvIII_max <- 3.0
juvIV_min  <- 3.0
juvIV_max <- 4.0
juvV_min  <- 4.0
juvV_max <- 5.0
adultI_min <- 5.0
adultI_max <- 7.0
adultII_min <- 7.0
adultII_max <- L_as_F
LL = 0.3
LJ = (juvI_min+juvI_max)/2 #cm
LJ2 = (juvII_min+juvII_max)/2   # 3cm
LJ3 = (juvIII_min+juvIII_max)/2
LJ4 = (juvIV_min+juvIV_max)/2
LJ5 = (juvV_min+juvV_max)/2
LA1 = (adultI_min + adultI_max)/2
LA2 = (adultII_min + adultII_max)/2  #cm
time_range <- seq(1,1095) #3 years
temperature_range <- seq(0,30, 0.1) #(10,15)
development_df_juvI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C:
for (i in temperature_range){
development <- c()
initial_l <- 6 #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvI[as.character(i)] <- development
}
dev_time_juvI <- sapply(development_df_juvI, function(col){
BrownShrimp::count_devDays(col, juvI_min*10, juvI_max*10) } )
dev_time_juvI <- dev_time_juvI[-c(1)] #delete first element, which doesn't make sence !
#### Following lines only for exploration purposes ####
#now simulate again, with own growth function (with K_func as TPC)
developmentAF_df_juvI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C:
for (i in temperature_range){
development <- c()
initial_l <- 0.6 #cm
for (j in time_range){
new_legth <- som_growthAF(initial_l, i, "F")
development <- append(development, new_legth)
initial_l <- new_legth
}
developmentAF_df_juvI[as.character(i)] <- development
}
dev_timeAF_juvI <- sapply(developmentAF_df_juvI, function(col){
BrownShrimp::count_devDays(col, juvI_min, juvI_max) } )
dev_timeAF_juvI <- dev_timeAF_juvI[-c(1)]
plot(temperature_range, dev_time_juvI, type = "b", col = "blue",
xlab = "Temperature (°C)", ylab = "Development time",
main = "Development Time vs Temperature")
lines(temperature_range, dev_timeAF_juvI, type = "b", col = 'red' , cex = 0.5)
legend("topright", legend = c("Original", "AF model"), col = c("blue", "red"), lty = 1, pch = 1)
#Looks ok in my opinion (beside the fact that from T above ~26° due to TPC curve start to rise again)
U_function <- function(a, h, x , k){
return (a*((x-h)^22) + k )
}
a = 1.e-22
h = 15
k = 3
plot(temperature_range, U_function(a, h, temperature_range, k))
#### continue wiht shifting funciton ####
#the parameter values where calculated in file determine_growthFunction.R
shift_next_sizeClass = function(Te, sizeClass){
ratio = 0
if (Te <= 1) {
ratio = 0
} else {
if (sizeClass == 'juvI'){
a = 11.73753
b = 2.205524
c = 1747.899
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvII'){
a = 26.25511 #coef(fit_juvII)[1]
b = 1.155226  #coef(fit_juvII)[3]
c = 2309.817 #coef(fit_juvII)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvIII'){
a = 29.84754 #coef(fit_juvIII)[1]
b = 1.164127 #coef(fit_juvIII)[3]
c = 4889.531 #coef(fit_juvIII)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvIV'){
a = 34.40965  #coef(fit_juvIV)[1]
b = 1.099193  #coef(fit_juvIV)[3]
c = 9141.399  #coef(fit_juvIV)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvV'){
a = 43.12777 #coef(fit_juvV)[1]
b = 1.09148  #coef(fit_juvV)[3]
c = 21729.47 #coef(fit_juvV)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'adultI'){
a = 142.2711 #coef(fitII_adultI)[1]
b = 0.9313728 #coef(fitII_adultI)[2]
c = 122405.3  #coef(fitII_adultI)[3]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'egg'){
ratio = 1/ (1031.34*Te^-1.345)
}
if (sizeClass == 'larv' ){
ratio = 1 / ((5.5/0.00584)*Te^-1.347)
}
return (ratio)
}
}
the.method = 'rk4'
h = 0.2 # half saturatuion constant original aprox .5
L_inf = 8.5
epsilon = 0.22
m = 3
const_c = 0.01 # reference density g/cm3
state2 <- c(P = 2, E = 0.1, L= 0.4 , J = .175 , J2 = 0.125, J3 = 0.125, J4 = 0.1, J5 = 0.1, A1 = 0.35, A2 = 0.1)
t = seq(0,length(temperature_10_11$temperature)-0.1, by = 0.1)
t_5years = seq(0,length(temperature_10_14$temperature)-0.1, by = 0.1)
parameters = c()
start <- Sys.time()
test_briere <- solver_sizeClass_extended_b(t = t_5years, state = state2, parameters = parameters, temperature_10_14)
print(Sys.time() - start)
start_date <- as.POSIXct("2010-01-01", format="%Y-%m-%d", tz = "UTC")
