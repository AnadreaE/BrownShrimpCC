size_width = .5
size_limits = seq(1,L_as_F,by=size_width)
size_limits
size_limits_F
size_width = .5
size_limits_F = seq(1,L_as_F,by=size_width)
size_mean_F = size_limits_F + 0.5*size_width
g_i = shift_next_sizeClass(size_mean_F[i], Te, parameters$Fem_params,size_width=size_width)
size_limits_F = seq(1,L_as_F,by=size_width)
size_mean_F = size_limits_F + 0.5*size_width
BF = 0*size_mean_F
dBF.dt = 0*size_mean_F
BF
size_limits_M = seq(1,L_as_M,by=size_width)
size_mean_M = size_limits_M + 0.5*size_width
BM = 0*size_mean_M
dBM.dt = 0*size_mean_M
BM
size_limits_F = seq(1,L_as_F,by=size_width)
size_mean_F = size_limits_F + 0.5*size_width
BF = 0*size_mean_F
dBF.dt = 0*size_mean_F
N_max_F = length(size_mean_F)
size_limits_M = seq(1,L_as_M,by=size_width)
size_mean_M = size_limits_M + 0.5*size_width
BM = 0*size_mean_M
dBM.dt = 0*size_mean_M
N_max_M = length(size_mean_F)
#VERSION 4
solver_sizeClass.v4 = function(t, state, parameters, temperature_dataSet){
system.equations = function(t, state, parameters) {
#following line avoid negative values in state variables
state[state < 0] = 0 # shift negative biomasses to 0
list2env(as.list(state), envir = environment())  # re-assign the corrected state variables
Te = temperature_funcSolver(temperature_dataSet, t) # getting temperature for day t from temperature_dataSet
month = month(temperature_dataSet$date_time[t+1]) # t starts in 0, but indices in R start at 1
dPred.dt = Bcod(t) - Pred*0.15 #0.08 mortality
size_width = .5
#LARVAE
gE = hatch_eggs(Te)
IL = ingestion_rate_b(Te, LL, P, parameters$general_params, parameters$Fem_params)
mL = respiration_rate_b(Te,LL, parameters$Fem_params)
gL = shiftTo_juvenile(Te)
pL = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = LL) #predation Larvae #l_pred abg of larvae cod
dL.dt = gE*E + IL*L - mL*L - gL*L - pL*L
promoting_L = gL*L
produced_eggs = 0
consumed_plankton = 0
promoting = 0.5*promoting_L
#Juvenile or adult shrimp F
for(i in 1:N_max_F){
I_i = ingestion_rate_b(Te, size_mean_F[i], P, parameters$general_params, parameters$Fem_params)
s_i = spawning_rate_b(size_mean_F[i], Te, parameters$Fem_params)
m_i = respiration_rate_b(Te, size_mean_F[i], parameters$Fem_params)
g_i = shift_next_sizeClass(size_mean_F[i], Te, parameters$Fem_params,size_width=size_width)
mol_i = molting_fraction(size_mean_F[i], Te)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_F) aging_i = parameters$general_params$a_mu
dBF.dt[i] = promoting + BF[i]*(I_i- m_i - s_i*mol_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BF[i]
produced_eggs = produced_eggs + s_i*mol_i*BF[i]
consumed_plankton = consumed_plankton + I_i*BF[i]
}
promoting = 0.5*promoting_L
#Juvenile or adult shrimp M
for(i in 1:N_max_M){
I_i = ingestion_rate_b(Te, size_mean_M[i], P, parameters$general_params, parameters$M_params)
m_i = respiration_rate_b(Te, size_mean_M[i], parameters$M_params)
g_i = shift_next_sizeClass(size_mean_M[i], Te, parameters$M_params,size_width=size_width)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_M) aging_i = parameters$general_params$a_mu
dBM.dt[i] = promoting + BM[i]*(I_i- m_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BM[i]
consumed_plankton = consumed_plankton + I_i*BM[i]
}
#Eggs
dE.dt =  produced_eggs - gE*E
#Plankton
dP.dt = new_food(t) - consumed_plankton
list(c(dP.dt, dE.dt, dL.dt,
dJ_f.dt, dJ2_f.dt, dJ3_f.dt, dJ4_f.dt, dJ5_f.dt,
dJ_m.dt, dJ2_m.dt, dJ3_m.dt, dJ4_m.dt, dJ5_m.dt,
dA1_f.dt, dA1_m.dt,
dA2.dt, dA3.dt,
dPred.dt) )
}
sol = ode(y = state, times = t, func = system.equations, parms = parameters, method=the.method)
sol = as.data.frame(sol)
return(sol)
}
size_limits_F = seq(1,L_as_F,by=size_width)
size_mean_F = size_limits_F + 0.5*size_width
BF = 0*size_mean_F
dBF.dt = 0*size_mean_F
N_max_F = length(size_mean_F)
size_limits_M = seq(1,L_as_M,by=size_width)
size_mean_M = size_limits_M + 0.5*size_width
BM = 0*size_mean_M
dBM.dt = 0*size_mean_M
N_max_M = length(size_mean_F)
#VERSION 4
solver_sizeClass.v4 = function(t, state, parameters, temperature_dataSet){
system.equations = function(t, state, parameters) {
#following line avoid negative values in state variables
state[state < 0] = 0 # shift negative biomasses to 0
list2env(as.list(state), envir = environment())  # re-assign the corrected state variables
Te = temperature_funcSolver(temperature_dataSet, t) # getting temperature for day t from temperature_dataSet
month = month(temperature_dataSet$date_time[t+1]) # t starts in 0, but indices in R start at 1
dPred.dt = Bcod(t) - Pred*0.15 #0.08 mortality
size_width = .5
#LARVAE
gE = hatch_eggs(Te)
IL = ingestion_rate_b(Te, LL, P, parameters$general_params, parameters$Fem_params)
mL = respiration_rate_b(Te,LL, parameters$Fem_params)
gL = shiftTo_juvenile(Te)
pL = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = LL) #predation Larvae #l_pred abg of larvae cod
dL.dt = gE*E + IL*L - mL*L - gL*L - pL*L
promoting_L = gL*L
produced_eggs = 0
consumed_plankton = 0
promoting = 0.5*promoting_L
#Juvenile or adult shrimp F
for(i in 1:N_max_F){
I_i = ingestion_rate_b(Te, size_mean_F[i], P, parameters$general_params, parameters$Fem_params)
s_i = spawning_rate_b(size_mean_F[i], Te, parameters$Fem_params)
m_i = respiration_rate_b(Te, size_mean_F[i], parameters$Fem_params)
g_i = shift_next_sizeClass(size_mean_F[i], Te, parameters$Fem_params,size_width=size_width)
mol_i = molting_fraction(size_mean_F[i], Te)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_F) aging_i = parameters$general_params$a_mu
dBF.dt[i] = promoting + BF[i]*(I_i- m_i - s_i*mol_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BF[i]
produced_eggs = produced_eggs + s_i*mol_i*BF[i]
consumed_plankton = consumed_plankton + I_i*BF[i]
}
promoting = 0.5*promoting_L
#Juvenile or adult shrimp M
for(i in 1:N_max_M){
I_i = ingestion_rate_b(Te, size_mean_M[i], P, parameters$general_params, parameters$M_params)
m_i = respiration_rate_b(Te, size_mean_M[i], parameters$M_params)
g_i = shift_next_sizeClass(size_mean_M[i], Te, parameters$M_params,size_width=size_width)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_M) aging_i = parameters$general_params$a_mu
dBM.dt[i] = promoting + BM[i]*(I_i- m_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BM[i]
consumed_plankton = consumed_plankton + I_i*BM[i]
}
#Eggs
dE.dt =  produced_eggs - gE*E
#Plankton
dP.dt = new_food(t) - consumed_plankton
list(c(dP.dt, dE.dt, dL.dt,
dBM.dt, dBF.dt,
dPred.dt) )
}
sol = ode(y = state, times = t, func = system.equations, parms = parameters, method=the.method)
sol = as.data.frame(sol)
return(sol)
}
BM
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF, BM,
Pred = 0.05 )
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF, BM,
Pred = 0.05 )
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
devtools::load_all(".")
devtools::load_all(".")
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF, BM,
Pred = 0.05 )
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
library(ggplot2)
library(deSolve)
library(RColorBrewer)
library(BrownShrimp)
library(viridis)
library(dplyr)
library(tidyr)
library("colorspace")
library(lubridate)
library(latex2exp)
library(profvis)
temperature_dataSet <- read.csv("./data/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_14_18 <- temperature_func(temperature_dataSet, "01/01/2014", "31/12/2018")
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
J_f = 2, J2_f = 2, J3_f = 2 , J4_f = 1.8, J5_f = 1.8,
J_m = 2 , J2_m = 2, J3_m = 2, J4_m = 1.8, J5_m = 1.8,
A1_f = 5.443*0.5, A1_m = 5.443*0.5,
A2 = 5.443*0.375, A3=5.443*0.125, #males doesn't reach this size classes
Pred = 0.05 )
t_5years = seq(0,length(temperature_14_18$temperature)-0.1, by = 0.1)
noPreasure_params = parameters_solv
noPreasure_params$general_params$Fi = 0 #No fishery
noPreasure_params$general_params$Imax_ik = 0 #No predation
start <- Sys.time()
test_noPreasure <- solver_sizeClass_sex.v3(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF, BM,
Pred = 0.05 )
start <- Sys.time()
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF = BF, BM = BM,
Pred = 0.05 )
start <- Sys.time()
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
BF
BM
state
devtools::load_all(".")
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF = BF, BM = BM,
Pred = 0.05 )
start <- Sys.time()
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
dP.dt
devtools::load_all(".")
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF = BF, BM = BM,
Pred = 0.05 )
start <- Sys.time()
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
t_5years
state
size_limits_F = seq(1,L_as_F,by=size_width)
size_mean_F = size_limits_F + 0.5*size_width
BF = 0*size_mean_F
dBF.dt = 0*size_mean_F
N_max_F = length(size_mean_F)
size_limits_M = seq(1,L_as_M,by=size_width)
size_mean_M = size_limits_M + 0.5*size_width
BM = 0*size_mean_M
dBM.dt = 0*size_mean_M
N_max_M = length(size_mean_M)
#VERSION 4
solver_sizeClass.v4 = function(t, state, parameters, temperature_dataSet){
system.equations = function(t, state, parameters) {
#following line avoid negative values in state variables
state[state < 0] = 0 # shift negative biomasses to 0
list2env(as.list(state), envir = environment())  # re-assign the corrected state variables
Te = temperature_funcSolver(temperature_dataSet, t) # getting temperature for day t from temperature_dataSet
month = month(temperature_dataSet$date_time[t+1]) # t starts in 0, but indices in R start at 1
dPred.dt = Bcod(t) - Pred*0.15 #0.08 mortality
size_width = .5
#LARVAE
gE = hatch_eggs(Te)
IL = ingestion_rate_b(Te, LL, P, parameters$general_params, parameters$Fem_params)
mL = respiration_rate_b(Te,LL, parameters$Fem_params)
gL = shiftTo_juvenile(Te)
pL = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = LL) #predation Larvae #l_pred abg of larvae cod
dL.dt = gE*E + IL*L - mL*L - gL*L - pL*L
promoting_L = gL*L
produced_eggs = 0
consumed_plankton = 0
promoting = 0.5*promoting_L
#Juvenile or adult shrimp F
for(i in 1:N_max_F){
I_i = ingestion_rate_b(Te, size_mean_F[i], P, parameters$general_params, parameters$Fem_params)
s_i = spawning_rate_b(size_mean_F[i], Te, parameters$Fem_params)
m_i = respiration_rate_b(Te, size_mean_F[i], parameters$Fem_params)
g_i = shift_next_sizeClass(size_mean_F[i], Te, parameters$Fem_params,size_width=size_width)
mol_i = molting_fraction(size_mean_F[i], Te)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_F) aging_i = parameters$general_params$a_mu
dBF.dt[i] = promoting + BF[i]*(I_i- m_i - s_i*mol_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BF[i]
produced_eggs = produced_eggs + s_i*mol_i*BF[i]
consumed_plankton = consumed_plankton + I_i*BF[i]
}
promoting = 0.5*promoting_L
#Juvenile or adult shrimp M
for(i in 1:N_max_M){
I_i = ingestion_rate_b(Te, size_mean_M[i], P, parameters$general_params, parameters$M_params)
m_i = respiration_rate_b(Te, size_mean_M[i], parameters$M_params)
g_i = shift_next_sizeClass(size_mean_M[i], Te, parameters$M_params,size_width=size_width)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_M) aging_i = parameters$general_params$a_mu
dBM.dt[i] = promoting + BM[i]*(I_i- m_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BM[i]
consumed_plankton = consumed_plankton + I_i*BM[i]
}
#Eggs
dE.dt =  produced_eggs - gE*E
#Plankton
dP.dt = new_food(t) - consumed_plankton
return(list(c(dP.dt, dE.dt, dL.dt,
dBF.dt, dBM.dt,
dPred.dt) ))
}
sol = ode(y = state, times = t, func = system.equations, parms = parameters, method=the.method)
sol = as.data.frame(sol)
return(sol)
}
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF = BF, BM = BM,
Pred = 0.05 )
start <- Sys.time()
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
test_noPreasure
plot(test_noPreasure$time,test_noPreasure$P)
plot(test_noPreasure$time,test_noPreasure$L)
plot(test_noPreasure$time,test_noPreasure$BF1)
plot(test_noPreasure$time,test_noPreasure$BF2)
plot(test_noPreasure$time,test_noPreasure$BF3)
plot(test_noPreasure$time,test_noPreasure$BF4)
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF = BF+0.1, BM = BM+0.1,
Pred = 0.05 )
start <- Sys.time()
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
plot(test_noPreasure$time,test_noPreasure$BF4)
plot(test_noPreasure$time,test_noPreasure$BM2)
size_width = .5
size_limits_F = seq(1,L_as_F,by=size_width)
size_mean_F = size_limits_F + 0.5*size_width
BF = 0*size_mean_F
dBF.dt = 0*size_mean_F
N_max_F = length(size_mean_F)
size_limits_M = seq(1,L_as_M,by=size_width)
size_mean_M = size_limits_M + 0.5*size_width
BM = 0*size_mean_M
dBM.dt = 0*size_mean_M
N_max_M = length(size_mean_M)
#VERSION 4
solver_sizeClass.v4 = function(t, state, parameters, temperature_dataSet){
system.equations = function(t, state, parameters) {
#following line avoid negative values in state variables
state[state < 0] = 0 # shift negative biomasses to 0
list2env(as.list(state), envir = environment())  # re-assign the corrected state variables
dBF.dt = BF * 0
dBM.dt = BM * 0
Te = temperature_funcSolver(temperature_dataSet, t) # getting temperature for day t from temperature_dataSet
month = month(temperature_dataSet$date_time[t+1]) # t starts in 0, but indices in R start at 1
# predator
dPred.dt = Bcod(t) - Pred*0.15 #0.08 mortality
#LARVAE
gE = hatch_eggs(Te)
IL = ingestion_rate_b(Te, LL, P, parameters$general_params, parameters$Fem_params)
mL = respiration_rate_b(Te,LL, parameters$Fem_params)
gL = shiftTo_juvenile(Te)
pL = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = LL) #predation Larvae #l_pred abg of larvae cod
dL.dt = gE*E + IL*L - mL*L - gL*L - pL*L
promoting_L = gL*L
produced_eggs = 0
consumed_plankton = 0
promoting = 0.5*promoting_L
#Juvenile or adult shrimp F
for(i in 1:N_max_F){
I_i = ingestion_rate_b(Te, size_mean_F[i], P, parameters$general_params, parameters$Fem_params)
s_i = spawning_rate_b(size_mean_F[i], Te, parameters$Fem_params)
m_i = respiration_rate_b(Te, size_mean_F[i], parameters$Fem_params)
g_i = shift_next_sizeClass(size_mean_F[i], Te, parameters$Fem_params,size_width=size_width)
mol_i = molting_fraction(size_mean_F[i], Te)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_F) aging_i = parameters$general_params$a_mu
dBF.dt[i] = promoting + BF[i]*(I_i- m_i - s_i*mol_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BF[i]
produced_eggs = produced_eggs + s_i*mol_i*BF[i]
consumed_plankton = consumed_plankton + I_i*BF[i]
}
promoting = 0.5*promoting_L
#Juvenile or adult shrimp M
for(i in 1:N_max_M){
I_i = ingestion_rate_b(Te, size_mean_M[i], P, parameters$general_params, parameters$M_params)
m_i = respiration_rate_b(Te, size_mean_M[i], parameters$M_params)
g_i = shift_next_sizeClass(size_mean_M[i], Te, parameters$M_params,size_width=size_width)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_M) aging_i = parameters$general_params$a_mu
dBM.dt[i] = promoting + BM[i]*(I_i- m_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BM[i]
consumed_plankton = consumed_plankton + I_i*BM[i]
}
#Eggs
dE.dt =  produced_eggs - gE*E
#Plankton
dP.dt = new_food(t) - consumed_plankton
return(list(c(dP.dt, dE.dt, dL.dt,
dBF.dt, dBM.dt,
dPred.dt) ))
}
sol = ode(y = state, times = t, func = system.equations, parms = parameters, method=the.method)
sol = as.data.frame(sol)
return(sol)
}
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF = BF+0.1, BM = BM+0.1,
Pred = 0.05 )
start <- Sys.time()
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
plot(test_noPreasure$time,test_noPreasure$BM2)
plot(test_noPreasure$time,test_noPreasure$BM2)
plot(test_noPreasure$time,test_noPreasure$BM1)
plot(test_noPreasure$time,test_noPreasure$BM2)
plot(test_noPreasure$time,test_noPreasure$BM3)
plot(test_noPreasure$time,test_noPreasure$BM6)
plot(test_noPreasure$time,test_noPreasure$BF4)
state
LL
P
LL
size_mean_F
size_width = .5
size_limits_F = seq(1,L_as_F,by=size_width)
size_mean_F = size_limits_F + 0.5*size_width
BF = 0*size_mean_F
dBF.dt = 0*size_mean_F
N_max_F = length(size_mean_F)
size_limits_M = seq(1,L_as_M,by=size_width)
size_mean_M = size_limits_M + 0.5*size_width
BM = 0*size_mean_M
dBM.dt = 0*size_mean_M
N_max_M = length(size_mean_M)
#VERSION 4
solver_sizeClass.v4 = function(t, state, parameters, temperature_dataSet){
system.equations = function(t, state, parameters) {
#following line avoid negative values in state variables
state[state < 0] = 0 # shift negative biomasses to 0
list2env(as.list(state), envir = environment())  # re-assign the corrected state variables
dBF.dt = BF * 0
dBM.dt = BM * 0
Te = temperature_funcSolver(temperature_dataSet, t) # getting temperature for day t from temperature_dataSet
month = month(temperature_dataSet$date_time[t+1]) # t starts in 0, but indices in R start at 1
# predator
dPred.dt = Bcod(t) - Pred*0.15 #0.08 mortality
#LARVAE
gE = hatch_eggs(Te)
IL = ingestion_rate_b(Te, LL, P, parameters$general_params, parameters$Fem_params)
mL = respiration_rate_b(Te,LL, parameters$Fem_params)
gL = shiftTo_juvenile(Te)
pL = Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = LL) #predation Larvae #l_pred abg of larvae cod
dL.dt = gE*E + IL*L - mL*L - gL*L - pL*L
promoting_L = gL*L
produced_eggs = 0
consumed_plankton = 0
promoting = 0.5*promoting_L
#Juvenile or adult shrimp F
for(i in 1:N_max_F){
I_i = ingestion_rate_b(Te, size_mean_F[i], P, parameters$general_params, parameters$Fem_params)
s_i = spawning_rate_b(size_mean_F[i], Te, parameters$Fem_params)
m_i = respiration_rate_b(Te, size_mean_F[i], parameters$Fem_params)
g_i = shift_next_sizeClass(size_mean_F[i], Te, parameters$Fem_params,size_width=size_width)
mol_i = molting_fraction(size_mean_F[i], Te)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_F[i]) #fishing mortality
pL_i = 0 #Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_F[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_F) aging_i = parameters$general_params$a_mu
dBF.dt[i] = promoting + BF[i]*(I_i- m_i - s_i*mol_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BF[i]
produced_eggs = produced_eggs + s_i*mol_i*BF[i]
consumed_plankton = consumed_plankton + I_i*BF[i]
}
promoting = 0.5*promoting_L
#Juvenile or adult shrimp M
for(i in 1:N_max_M){
I_i = ingestion_rate_b(Te, size_mean_M[i], P, parameters$general_params, parameters$M_params)
m_i = respiration_rate_b(Te, size_mean_M[i], parameters$M_params)
g_i = shift_next_sizeClass(size_mean_M[i], Te, parameters$M_params,size_width=size_width)
fm_i = parameters$general_params$Fi*monthly_Feffort[month]*sel_probit(size_mean_M[i]) #fishing mortality
pL_i = 0 #Pred*ingestion_kernel(I_max= parameters$general_params$Imax_ik, l_pred = 2.75, l_prey = size_mean_M[i]) #predation Larvae #l_pred abg of larvae cod
aging_i = 0.0
if(i == N_max_M) aging_i = parameters$general_params$a_mu
dBM.dt[i] = promoting + BM[i]*(I_i- m_i - g_i - fm_i - pL_i - aging_i)
promoting = g_i*BM[i]
consumed_plankton = consumed_plankton + I_i*BM[i]
}
#Eggs
dE.dt =  produced_eggs - gE*E
#Plankton
dP.dt = new_food(t) - consumed_plankton
return(list(c(dP.dt, dE.dt, dL.dt,
dBF.dt, dBM.dt,
dPred.dt) ))
}
sol = ode(y = state, times = t, func = system.equations, parms = parameters, method=the.method)
sol = as.data.frame(sol)
return(sol)
}
state = c(P = 2, E = 0.1, L= 0.0928 *1.5 ,
BF = BF+0.1, BM = BM+0.1,
Pred = 0.05 )
start <- Sys.time()
test_noPreasure = solver_sizeClass.v4(t = t_5years, state = state, parameters = noPreasure_params, temperature_dataSet = temperature_14_18)
print(Sys.time() - start)
plot(test_noPreasure$time,test_noPreasure$BF4)
plot(test_noPreasure$time,test_noPreasure$BF4)
plot(test_noPreasure$time,test_noPreasure$l)
plot(test_noPreasure$time,test_noPreasure$L)
plot(test_noPreasure$time,test_noPreasure$E)
plot(test_noPreasure$time,test_noPreasure$L)
