temperature_range_red_juvI <- temperature_range[-indexes_1095]
#plot( (1:length(dev_time_JUVI_reduced))*0.1,  dev_time_JUVI_reduced, main = "Development days Juvenile \n reduced data" )
fit_juvI <- nls( dev_time_JUVI_reduced ~ ( a + c*exp(-b*temperature_range_red_juvI) ),
start = list(a = 40, c = 3000, b = 1))
a_juvI <- coef(fit_juvI)[1]
b_juvI <- coef(fit_juvI)[3]
c_juvI <- coef(fit_juvI)[2]
#(optional) plot results form fit:
plot(temperature_range, dev_time_juvI, pch = 1, col = 'gray28', las = 1, xlab = 'T [?C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv I')
lines(temperature_range_red_juvI, predict(fit_juvI), col = 'lightseagreen', lwd = 2.5)
#### JUVII ####
development_df_juvII <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- juvII_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvII[as.character(i)] <- development
}
dev_time_juvII <- sapply(development_df_juvII, function(col){
count_devDays(col, juvII_min, juvII_max) } )
dev_time_juvII <- dev_time_juvII[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_juvII, main = paste("Development days Juvenile \n with min_size =", juvII_min , "mm and max_size = ", juvII_max ,"mm") )
#Fitting curve for JUVI
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_juvII == 1095)
dev_time_JUVII_reduced <- dev_time_juvII[dev_time_juvII != 1095]
temperature_range_red_juvII <- temperature_range[-indexes_1095]
#length(temperature_range_red_juvI)
#length(dev_time_JUVI_reduced)
#plot( (1:length(dev_time_JUVII_reduced))*0.1,  dev_time_JUVII_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
fit_juvII <- nls( dev_time_JUVII_reduced ~ ( a + c*exp(-b*temperature_range_red_juvII) ),
start = list(a = 20, c = 1500, b = 1))
a_juvII <- coef(fit_juvII)[1]
b_juvII <- coef(fit_juvII)[3]
c_juvII <- coef(fit_juvII)[2]
#(optional) plot results form fit:
plot(temperature_range, dev_time_juvII, pch = 1, col = 'gray28', las = 1, xlab = 'T [?C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv II')
lines(temperature_range_red_juvII, predict(fit_juvII), col = 'lightseagreen', lwd = 2.5)
#### JUVIII ####
development_df_juvIII <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- juvIII_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvIII[as.character(i)] <- development
}
dev_time_juvIII <- sapply(development_df_juvIII, function(col){
count_devDays(col, juvIII_min, juvIII_max) } )
dev_time_juvIII <- dev_time_juvIII[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_juvIII, main = paste("Development days Juvenile \n with min_size =", juvIII_min , "mm and max_size = ", juvIII_max ,"mm") )
#Fitting curve for JUVIII
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_juvIII == 1095)
dev_time_juvIII_reduced <- dev_time_juvIII[dev_time_juvIII != 1095]
temperature_range_red_juvIII <- temperature_range[-indexes_1095]
#plot( (1:length(dev_time_juvIII_reduced))*0.1,  dev_time_juvIII_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
fit_juvIII <- nls( dev_time_juvIII_reduced ~ ( a + c*exp(-b*temperature_range_red_juvIII) ),
start = list(a = 20, c = 1500, b = 1))
a_juvIII <- coef(fit_juvIII)[1]
b_juvIII <- coef(fit_juvIII)[3]
c_juvIII <- coef(fit_juvIII)[2]
#(optional) plot results form fit:
plot(temperature_range, dev_time_juvIII, pch = 1, col = 'gray28', las = 1, xlab = 'T [°C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv III')
lines(temperature_range_red_juvIII, predict(fit_juvIII), col = 'lightseagreen', lwd = 2.5)
#### JUVIV ####
development_df_juvIV <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- juvIV_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvIV[as.character(i)] <- development
}
dev_time_juvIV <- sapply(development_df_juvIV, function(col){
count_devDays(col, juvIV_min, juvIV_max) } )
dev_time_juvIV <- dev_time_juvIV[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_juvIV, main = paste("Development days Juvenile \n with min_size =", juvIV_min , "mm and max_size = ", juvIV_max ,"mm") )
#Fitting curve for juvIV
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_juvIV == 1095)
dev_time_juvIV_reduced <- dev_time_juvIV[dev_time_juvIV != 1095]
temperature_range_red_juvIV <- temperature_range[-indexes_1095]
#plot( (1:length(dev_time_juvIV_reduced))*0.1,  dev_time_juvIV_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
fit_juvIV <- nls( dev_time_juvIV_reduced ~ ( a + c*exp(-b*temperature_range_red_juvIV) ),
start = list(a = 20, c = 1500, b = 1))
a_juvIV <- coef(fit_juvIV)[1]
b_juvIV <- coef(fit_juvIV)[3]
c_juvIV <- coef(fit_juvIV)[2]
#(optional) plot results form fit:
plot(temperature_range, dev_time_juvIV, pch = 1, col = 'gray28', las = 1, xlab = 'T [?C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv IV')
lines(temperature_range_red_juvIV, predict(fit_juvIV), col = 'lightseagreen', lwd = 2.5)
#### juvV ####
development_df_juvV <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- juvV_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvV[as.character(i)] <- development
}
dev_time_juvV <- sapply(development_df_juvV, function(col){
count_devDays(col, juvV_min, juvV_max) } )
dev_time_juvV <- dev_time_juvV[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_juvV, main = paste("Development days Juvenile \n with min_size =", juvV_min , "mm and max_size = ", juvV_max ,"mm") )
#Fitting curve for juvV
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_juvV == 1095)
dev_time_juvV_reduced <- dev_time_juvV[dev_time_juvV != 1095]
temperature_range_red_juvV <- temperature_range[-indexes_1095]
#plot( (1:length(dev_time_juvV_reduced))*0.1,  dev_time_juvV_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
fit_juvV <- nls( dev_time_juvV_reduced ~ ( a + c*exp(-b*temperature_range_red_juvV) ),
start = list(a = 20, c = 1500, b = 1))
a_juvV <- coef(fit_juvV)[1]
b_juvV <- coef(fit_juvV)[3]
c_juvV <- coef(fit_juvV)[2]
#(optional) plot results form fit:
plot(temperature_range, dev_time_juvV, pch = 1, col = 'gray28', las = 1, xlab = 'T [?C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Juv V')
lines(temperature_range_red_juvV, predict(fit_juvV), col = 'lightseagreen', lwd = 2.5)
#### adultI ####
development_df_adultI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1?C:
for (i in temperature_range){
development <- c()
initial_l <- adultI_min #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_adultI[as.character(i)] <- development
}
dev_time_adultI <- sapply(development_df_adultI, function(col){
count_devDays(col, adultI_min, adultI_max) } )
dev_time_adultI <- dev_time_adultI[-c(1)] #first row doesn't make sence
#plot( (1:251)*0.1,  dev_time_adultI, main = paste("Development days Juvenile \n with min_size =", adultI_min , "mm and max_size = ", adultI_max ,"mm") )
#Fitting curve for adultI
#first: delete all values = 1095:
indexes_1095 <- which(dev_time_adultI == 1095)
dev_time_adultI_reduced <- dev_time_adultI[dev_time_adultI != 1095]
temperature_range_red_adultI <- temperature_range[-indexes_1095]
#plot( temperature_range_red_adultI,  dev_time_adultI_reduced, main = "Development days Juvenile II \n reduced data", xlab = "T ?C", las = 1)
#view <- development_df_adultI['20.8']
#Failed to make a good fit for the U shape, temporary solution:
#ignore all T values from < 20 (because from 20?C dev. time rises again)
temperature_range_redII_adultI <- temperature_range_red_adultI[temperature_range_red_adultI <= 20]
dev_time_adultI_reducedII <- dev_time_adultI_reduced[1: length(temperature_range_redII_adultI)] #as I know that I want to unselect the last values
fitII_adultI <- nls( dev_time_adultI_reducedII ~ ( a + c*exp(-b*temperature_range_redII_adultI) ),
start = list(a = 100, c = 3000, b = 1))
a_adultI <- coef(fitII_adultI)[1]
b_adultI <- coef(fitII_adultI)[3]
c_adultI <- coef(fitII_adultI)[2]
plot(temperature_range, dev_time_adultI, pch = 1, col = 'gray28', las = 1, xlab = 'T [°C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Adult I')
lines(temperature_range_redII_adultI, predict(fitII_adultI), col = 'lightseagreen', lwd = 2.5)
plot(temperature_range, 1/dev_time_adultI, pch = 1, col = 'gray28', las = 1, xlab = 'T [°C]', ylab = 'developent time [days]', cex.lab = 1.5, main = 'Class: Adult I')
#Shifts of Biomass function
shift_next_sizeClass = function(Te, sizeClass){
ratio = 0
if (Te <= 0) {
return (0)
} else {
if (sizeClass == 'juvI'){
a = 11.73753
b = 2.205524
c = 1747.899
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvII'){
a = coef(fit_juvII)[1]
b = coef(fit_juvII)[3]
c = coef(fit_juvII)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvIII'){
a = coef(fit_juvIII)[1]
b = coef(fit_juvIII)[3]
c = coef(fit_juvIII)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvIV'){
a = coef(fit_juvIV)[1]
b = coef(fit_juvIV)[3]
c = coef(fit_juvIV)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvV'){
a = coef(fit_juvV)[1]
b = coef(fit_juvV)[3]
c = coef(fit_juvV)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'adultI'){
a = coef(fitII_adultI)[1]
b = coef(fitII_adultI)[2]
c = coef(fitII_adultI)[3]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'egg'){
ratio = 1/ (1031.34*Te^-1.345)
}
if (sizeClass == 'larv' ){
ratio = 1 / ((5.5/0.00584)*Te^-1.347)
}
return (ratio)
}
}
##### SYSTEM ########
the.method = 'rk4'
h = 0.2 # half saturatuion constant original aprox .5
L_inf = 8.5
epsilon = 0.22
m = 3
const_c = 0.01 # reference density g/cm3
t = seq(0,length(temperature_10_11$temperature)-0.1, by = 0.1)
t_5years = seq(0,length(temperature_10_14$temperature)-0.1, by = 0.1)
state = c(P = 2, E = 0.1, L= 0.4 , J = .4 , J2 = 0.3, J3 = 0.3, J4 = 0.2, J5 = 0.2, A1 = 0.35, A2 = 0.1)
#state = c(P = 100, E = 2, L= 40 , J = 70 , J2 = 50, A2 = 40)
parameters = c()
dev.off()
state2 <- c(P = 2, E = 0.1, L= 0.4 , J = .175 , J2 = 0.125, J3 = 0.125, J4 = 0.1, J5 = 0.1, A1 = 0.35, A2 = 0.1)
start <- Sys.time()
cc_2 <- solver_sizeClass_extended(t = t_5years, state = state2, parameters = parameters, temperature_10_14)
print(Sys.time() - start)
#add dateTime column:
start_date <- as.POSIXct("2010-01-01", format="%Y-%m-%d", tz = "UTC")
cc_2 <- mutate(cc_2, dateTime = start_date + cc_2$time * 86400) #86400 seconds in one day
cc_2 <- cc_2[ , -1] # delete timesteps column
#cc_long_2 <- gather(cc_2, key = "Type", value = "Value", P, E, L, J, J2, J3, J4, J5, A1, A2)
cc_2_long <- cc_2 %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
ggplot(cc_2_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " extended size classes aprox. each 10 mm \n 2010-2014", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,"J" = "#bfd3e6", "J2" = "#9ebcda", "J3" = "#8c96c6", "J4" = "#8856a7", "J5" = "#810f7c" ,
"A1" = "#fd8d3c" ,"A2" = "#e6550d" )) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom")
df_long <- df_long_prev[ ,-1] %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
df_long2 <- cc_2[ ,-1] %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
# Calculate total at each time point and normalize to proportions
#df_long$Date <- as.Date(df$time, origin = "01/01/2010")  # If time starts at 0 "31/12/2009"
#ensure that vertical order is same as life stages
stack_order <- rev(c(colnames(cc_2)[2:10]) ) #rev(c(names(df_long_prev)[2:10], 'sum_all') )
# Ensure 'variable' is a factor with levels in the same order
df_long2$variable <- factor(df_long2$variable, levels = stack_order)
#dev.off()
ggplot(df_long2, aes(x = dateTime, y = value, fill = variable)) +
geom_area() +
scale_fill_viridis_d() +
labs(
title = "",
x = "Date",
y = "Biomass",
fill = "Size class"
)
#HERE SIMULATIONS WITH NEW K-FUNC tpc FLEXBRIERE
library(dplyr)
library(ggplot2)
library(cowplot) #for combined plots
library(RColorBrewer)
library("colorspace")
library(deSolve)
library(tidyr)
library(RColorBrewer)
library(BrownShrimp)
library(viridis)
library(devtools)
#UPLOAD TEMPERATURE DATA
temperature_dataSet <- read.csv("C:/Users/andre/Desktop/Hereon/Data/Wadden Sea, Penning/Temperature_data_1982-2018_MarBiol.csv", header = TRUE, sep = ';')
temperature_10_11 <- temperature_func(temperature_dataSet, "01/01/2010", "31/12/2011")
temperature_10_14 <- temperature_func(temperature_dataSet, "01/01/2010", "31/12/2014")
######### START ###########
#Def. Size Classes ranges [cm]
L_as_F <- 8.5
juvI_min <- .6
juvI_max <- 1.0
juvII_min  <- 1.0
juvII_max <- 2.0
juvIII_min  <- 2.0
juvIII_max <- 3.0
juvIV_min  <- 3.0
juvIV_max <- 4.0
juvV_min  <- 4.0
juvV_max <- 5.0
adultI_min <- 5.0
adultI_max <- 7.0
adultII_min <- 7.0
adultII_max <- L_as_F
LL = 0.3
LJ = (juvI_min+juvI_max)/2 #cm
LJ2 = (juvII_min+juvII_max)/2   # 3cm
LJ3 = (juvIII_min+juvIII_max)/2
LJ4 = (juvIV_min+juvIV_max)/2
LJ5 = (juvV_min+juvV_max)/2
LA1 = (adultI_min + adultI_max)/2
LA2 = (adultII_min + adultII_max)/2  #cm
time_range <- seq(1,1095) #3 years
temperature_range <- seq(0,30, 0.1) #(10,15)
development_df_juvI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C:
for (i in temperature_range){
development <- c()
initial_l <- 6 #mm
for (j in time_range){
new_legth <- som_growth(initial_l, i, 85, 'F')
development <- append(development, new_legth)
initial_l <- new_legth
}
development_df_juvI[as.character(i)] <- development
}
dev_time_juvI <- sapply(development_df_juvI, function(col){
BrownShrimp::count_devDays(col, juvI_min*10, juvI_max*10) } )
dev_time_juvI <- dev_time_juvI[-c(1)] #delete first element, which doesn't make sence !
#### Following lines only for exploration purposes ####
#now simulate again, with own growth function (with K_func as TPC)
developmentAF_df_juvI <- data.frame(row = seq(1, 1095))
#simulate development with constant temperature for each 0.1°C:
for (i in temperature_range){
development <- c()
initial_l <- 0.6 #cm
for (j in time_range){
new_legth <- som_growthAF(initial_l, i, "F")
development <- append(development, new_legth)
initial_l <- new_legth
}
developmentAF_df_juvI[as.character(i)] <- development
}
dev_timeAF_juvI <- sapply(developmentAF_df_juvI, function(col){
BrownShrimp::count_devDays(col, juvI_min, juvI_max) } )
dev_timeAF_juvI <- dev_timeAF_juvI[-c(1)]
plot(temperature_range, dev_time_juvI, type = "b", col = "blue",
xlab = "Temperature (°C)", ylab = "Development time",
main = "Development Time vs Temperature")
lines(temperature_range, dev_timeAF_juvI, type = "b", col = 'red' , cex = 0.5)
legend("topright", legend = c("Original", "AF model"), col = c("blue", "red"), lty = 1, pch = 1)
#Looks ok in my opinion (beside the fact that from T above ~26° due to TPC curve start to rise again)
U_function <- function(a, h, x , k){
return (a*((x-h)^22) + k )
}
a = 1.e-22
h = 15
k = 3
plot(temperature_range, U_function(a, h, temperature_range, k))
#### continue wiht shifting funciton ####
#the parameter values where calculated in file determine_growthFunction.R
shift_next_sizeClass = function(Te, sizeClass){
ratio = 0
if (Te <= 1) {
ratio = 0
} else {
if (sizeClass == 'juvI'){
a = 11.73753
b = 2.205524
c = 1747.899
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvII'){
a = 26.25511 #coef(fit_juvII)[1]
b = 1.155226  #coef(fit_juvII)[3]
c = 2309.817 #coef(fit_juvII)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvIII'){
a = 29.84754 #coef(fit_juvIII)[1]
b = 1.164127 #coef(fit_juvIII)[3]
c = 4889.531 #coef(fit_juvIII)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvIV'){
a = 34.40965  #coef(fit_juvIV)[1]
b = 1.099193  #coef(fit_juvIV)[3]
c = 9141.399  #coef(fit_juvIV)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'juvV'){
a = 43.12777 #coef(fit_juvV)[1]
b = 1.09148  #coef(fit_juvV)[3]
c = 21729.47 #coef(fit_juvV)[2]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'adultI'){
a = 142.2711 #coef(fitII_adultI)[1]
b = 0.9313728 #coef(fitII_adultI)[2]
c = 122405.3  #coef(fitII_adultI)[3]
ratio = 1 / (a + c*exp(-b*Te))
}
if (sizeClass == 'egg'){
ratio = 1/ (1031.34*Te^-1.345)
}
if (sizeClass == 'larv' ){
ratio = 1 / ((5.5/0.00584)*Te^-1.347)
}
return (ratio)
}
}
the.method = 'rk4'
h = 0.2 # half saturatuion constant original aprox .5
L_inf = 8.5
epsilon = 0.22
m = 3
const_c = 0.01 # reference density g/cm3
state2 <- c(P = 2, E = 0.1, L= 0.4 , J = .175 , J2 = 0.125, J3 = 0.125, J4 = 0.1, J5 = 0.1, A1 = 0.35, A2 = 0.1)
t = seq(0,length(temperature_10_11$temperature)-0.1, by = 0.1)
t_5years = seq(0,length(temperature_10_14$temperature)-0.1, by = 0.1)
parameters = c()
start <- Sys.time()
test_briere <- solver_sizeClass_extended_b(t = t_5years, state = state2, parameters = parameters, temperature_10_14)
print(Sys.time() - start)
start_date <- as.POSIXct("2010-01-01", format="%Y-%m-%d", tz = "UTC")
test_briere <- mutate(test_briere, dateTime = start_date + test_briere$time * 86400) #86400 seconds in one day
test_briere <- test_briere[ , -1] # delete timesteps column
#cc_long_2 <- gather(cc_2, key = "Type", value = "Value", P, E, L, J, J2, J3, J4, J5, A1, A2)
test_briere_long <- test_briere %>%
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
#dev.off()
ggplot(test_briere_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " extended size classes Briere aprox. each 10 mm \n 2010-2014", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,"J" = "#bfd3e6", "J2" = "#9ebcda", "J3" = "#8c96c6", "J4" = "#8856a7", "J5" = "#810f7c" ,
"A1" = "#fd8d3c" ,"A2" = "#e6550d" )) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom")
ggplot(test_briere_long, aes(x = dateTime, y = value, color = variable)) +
geom_line(size = 1) +  # Plot lines
labs(title = " extended size classes Briere aprox. each 10 mm \n 2010-2014", x = "Days", y = "Biomass") +
scale_color_manual(
values = c( "P" = "#d9f0a3", "E"= "#1c9099" ,"L" = "gray"  ,"J" = "#bfd3e6", "J2" = "#9ebcda", "J3" = "#8c96c6", "J4" = "#8856a7", "J5" = "#810f7c" ,
"A1" = "#fd8d3c" ,"A2" = "#e6550d" )) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5), # Center title
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
legend.position="bottom") + ylim(0,50)
df_long_testBriere <- test_briere[ , -1] %>% #delete  plancton col
pivot_longer(-dateTime, names_to = "variable", values_to = "value")
#ensure that vertical order is same as life stages
stack_order_Br <- rev(c(colnames(test_briere)[2:10]) )
# Ensure 'variable' is a factor with levels in the same order
df_long_testBriere$variable <- factor(df_long_testBriere$variable, levels = stack_order_Br)
ggplot(df_long_testBriere, aes(x = dateTime, y = value, fill = variable)) +
geom_area() +
scale_fill_viridis_d() +
labs(
title = "K func as TPC",
x = "Date",
y = "Biomass",
fill = "Size class"
)
sizes <- c(1.8, 2.8, 3.8, 4.8) #cm
par(mfrow = c(2,2))
for (i in sizes){
plot(temp_range, natural_mortality_test(temp_range, i) , type = "b", col = "blue",
xlab = "Temperature (°C)", ylab = " ",
main = paste("L = ", i, " cm K_func inverese \n mu = convertL_to_W(L)* K_inv"),
cex.main = 1.5, cex.lab = 1.5, cex.axis = 1.5)#, ylim = c(0, 0.6) )
lines(temp_range, sapply(temp_range, natural_mortality_test_b, i) , type = "b", col = "red")
}
temp_range = seq(1,30, 0.1)
sizes <- c(1.8, 2.8, 3.8, 4.8) #cm
par(mfrow = c(2,2))
for (i in sizes){
plot(temp_range, natural_mortality_test(temp_range, i) , type = "b", col = "blue",
xlab = "Temperature (°C)", ylab = " ",
main = paste("L = ", i, " cm K_func inverese \n mu = convertL_to_W(L)* K_inv"),
cex.main = 1.5, cex.lab = 1.5, cex.axis = 1.5)#, ylim = c(0, 0.6) )
lines(temp_range, sapply(temp_range, natural_mortality_test_b, i) , type = "b", col = "red")
}
sizes <- c(1.8, 2.8, 3.8, 4.8) #cm
par(mfrow = c(2,2))
for (i in sizes){
plot(temp_range, natural_mortality_test(temp_range, i) , type = "b", col = "blue",
xlab = "Temperature (°C)", ylab = " ",
main = paste("L = ", i, " cm K_func inverese \n mu = convertL_to_W(L)* K_inv"),
cex.main = 1.5, cex.lab = 1.5, cex.axis = 1.5)#, ylim = c(0, 0.6) )
lines(temp_range, sapply(temp_range, natural_mortality_test_b, i) , type = "b", col = "red", cex = 0.5)
}
sizes <- c(1.8, 2.8, 3.8, 4.8) #cm
par(mfrow = c(2,2))
for (i in sizes){
plot(temp_range, natural_mortality_test(temp_range, i) , type = "b", col = "blue",
xlab = "Temperature (°C)", ylab = " ",
main = paste("L = ", i, " cm K_func inverese \n mu = convertL_to_W(L)* K_inv"),
cex.main = 1.5, cex.lab = 1.5, cex.axis = 1.5)#, ylim = c(0, 0.6) )
lines(temp_range, sapply(temp_range, natural_mortality_test_b, i) , type = "b", col = "red", cex = 0.8)
}
